var MH_PageComposer=MH_PageComposer||{};window.wp=window.wp||{},function(e){for(var t=0,i=0;i<Math.ceil(mhc_options.mh_composer_modules_count/mhc_options.mh_composer_templates_amount);i++)!function(t){e.ajax({type:"POST",dataType:"json",url:mhc_options.ajaxurl,data:{action:"mhc_get_app_templates",mh_post_type:mhc_options.post_type,mh_admin_load_nonce:mhc_options.mh_admin_load_nonce,mh_templates_start_from:t},success:function(t){e("body").append(t.templates)}})}(i*mhc_options.mh_composer_templates_amount);e(document).ready(function(){function i(){e("#mh-composer-right-click-controls").remove(),e("#mhc_layout_right_click_overlay").remove()}function o(t){t.click(function(t){var i=e(this);t.preventDefault(),(U=wp.media.frames.mhc_file_frame=wp.media({title:i.data("choose"),library:{type:i.data("type")},button:{text:i.data("update")},multiple:!1})).on("select",function(){var e=U.state().get("selection").first().toJSON();i.siblings(".mhc-upload-field").val(e.url),a(i)}),U.open()}),t.siblings(".mhc-upload-field").on("input",function(){a(e(this).siblings(".mhc-upload-button"))}),t.siblings(".mhc-upload-field").each(function(){a(e(this).siblings(".mhc-upload-button"))})}function n(t){t.click(function(i){function o(t){setTimeout(function(){t.find(".gallery-settings").find("label.setting").each(function(){e(this).find(".link-to, .columns, .size").length?e(this).remove():e(this).has("input[type=checkbox]").length&&e(this).children("input[type=checkbox]").css("margin","11px 5px")})},10)}e(this);if($gallery_ids=t.closest(".mhc-option").siblings(".mhc-option-gallery_ids").find(".mhc-gallery-ids-field"),$gallery_orderby=t.closest(".mhc-option").siblings(".mhc-option-gallery_orderby").find(".mhc-gallery-ids-field"),i.preventDefault(),"undefined"!=typeof wp&&wp.media&&wp.media.gallery){var n=$gallery_ids.val().length?' ids="'+$gallery_ids.val()+'"':"",s="[gallery"+n+($gallery_orderby.val().length?' orderby="'+$gallery_orderby.val()+'"':"")+"]";U=wp.media.frames.mhc_file_frame=wp.media.gallery.edit(s),n||U.setState("gallery-vault"),o(U.$el),U.on("content:render:browse",function(e){o(e.$el)}),U.state("gallery-edit").on("update",function(e){var t=wp.media.gallery.shortcode(e).attrs.named;t.ids&&$gallery_ids.val(t.ids),t.orderby?$gallery_orderby.val(t.orderby):$gallery_orderby.val("")})}})}function s(t){t.click(function(t){var i=e(this),o=e("#mhc_src.mhc-upload-field").val().trim();t.preventDefault(),e.ajax({type:"POST",url:mhc_options.ajaxurl,data:{action:"mhc_video_get_oembed_thumbnail",mh_admin_load_nonce:mhc_options.mh_admin_load_nonce,mh_video_url:o},success:function(t){t.length?e("#mhc_image_src").val(t).trigger("input"):(i.after('<div class="mhc-error">'+mhc_options.video_module_image_error+"</div>"),i.siblings(".mhc-error").delay(5e3).fadeOut(800))}})})}function a(e){var t=e.siblings(".mhc-upload-field"),i=t.siblings(".mhc-upload-preview"),o=t.val().trim();"image"===e.data("type")&&(""!==o?(i.length||(e.siblings(".description").before('<div class="mhc-upload-preview"><strong class="mhc-upload-preview-title">'+mhc_options.preview_image+'</strong><img src="" width="408" /></div>'),i=t.siblings(".mhc-upload-preview")),i.find("img").attr("src",o)):i.length&&i.remove())}function l(){var t=e("body"),i=0;v("content",Q.val()),window.wpActiveEditor="content",X.val("off"),G.hide(),K.text(K.data("composer")).toggleClass("mhc_composer_is_used"),ee.toggleClass("mhc_hidden"),function(){if(ie.show().closest("#mh_settings_meta_box").show(),ie.closest("#mh_settings_meta_box").find(".mhc_side_nav_settings").hide(),Z.length){Z.show();var t=Z.find('input[type="radio"]:checked').val();e(".mh_mharty_format_setting.mh_mharty_"+t+"_settings").show()}}(),i=t.scrollTop(),t.scrollTop(i+1),E.trigger("mh-deactivate-composer"),e(window).trigger("resize")}function d(t,o,n,s){var a=-1!==e.inArray(t,["save_template","reset_advanced_settings"])?" mh_modal_on_top":"",d=e('<div class="mhc_modal_overlay'+a+("reset_advanced_settings"===t?" mh_modal_on_top_both_actions":"")+'" data-action="'+t+'"></div>'),c=e("#mh-composer-prompt-modal-"+t).length?e("#mh-composer-prompt-modal-"+t).html():e("#mh-composer-prompt-modal").html(),h=_.template(e("#mh-composer-prompt-modal-"+t+"-text").html()),m={};if(i(),e("body").addClass("mhc_stop_scroll"),"save_template"===t){var u=void 0!==(w=z.getView(o.model.get("cid"))).model.get("parent")?z.getView(w.model.get("parent")):"",g=w.$el.find(".mhc_shared"),v=g.length?"has_shared":"no_shareds";m.is_shared=void 0!==w.model.get("mhc_shared_module")&&""!==w.model.get("mhc_shared_module")?"shared":"regular",m.is_shared_child=""!==u&&(void 0!==u.model.get("mhc_shared_module")&&""!==u.model.get("mhc_shared_module")||void 0!==u.model.get("shared_parent_cid")&&""!==u.model.get("shared_parent_cid"))?"shared":"regular",m.module_type=w.model.get("type")}if(d.append(c),d.find(".mhc_prompt_modal").prepend(h(m)),e("body").append(d),"auto"===e(".mhc_prompt_modal").css("bottom")&&window.mhc_align_vertical_modal(d.find(".mhc_prompt_modal"),".mhc_prompt_buttons"),setTimeout(function(){d.find("select, input, textarea, radio").filter(":eq(0)").focus()},1),"rename_admin_label"===t){var f=d.find("input#mhc_new_admin_label"),w=z.getView(o),y=w.model.get("admin_label").trim();""!==y&&f.val(y)}e(".mhc_modal_overlay .mhc_prompt_proceed").click(function(t){t.preventDefault();var i=e(this).closest(".mhc_modal_overlay");switch(i.data("action").trim()){case"deactivate_composer":l();break;case"clear_layout":F.removeAllSections(!0);break;case"rename_admin_label":var a=i.find("#mhc_new_admin_label").val().trim(),d=z.getView(o);if(""==a)return void i.find("#mhc_new_admin_label").focus();d.model.set("admin_label",a,{silent:!0}),d.renameModule(),F.allowHistorySaving("renamed","module",a),M();break;case"reset_advanced_settings":o.each(function(){k(e(this))});break;case"save_layout":var c=i.find("#mhc_new_layout_name").val().trim();if(""==c)return void i.find("#mhc_new_layout_name").focus();e.ajax({type:"POST",url:mhc_options.ajaxurl,data:{action:"mhc_save_layout",mh_admin_load_nonce:mhc_options.mh_admin_load_nonce,mh_layout_name:c,mh_layout_content:p("content"),mh_layout_type:"layout",mh_post_type:mhc_options.post_type},success:function(e){}});break;case"save_template":var h=i.find("#mhc_new_template_name").val().trim(),m=i.find(e("#mhc_template_shared")).is(":checked")?"shared":"not_shared",u=e(".mhc_module_settings").data("module_type"),f="section"===u||"row"===u?u:"module",w=void 0!==n?n:"regular",y=o.model.get("cid"),b="",C="",S="",$=i.find("#mhc_new_cat_name").val(),V=void 0!==v&&"has_shared"===v&&"shared"===m?"ignore_shared":"include_shared",x="ignore_shared"===V?ignore_shared_tabs:"",H=e(".mhc_modal_settings_container"),O=e(".mhc_modal_overlay");if(f="row_inner"===u?"row":f,""==h)return void i.find("#mhc_new_template_name").focus();if(e(".mhc_select_module_tabs").length){if(!e(".mhc_select_module_tabs input").is(":checked"))return void e(".mhc_error_message_save_template").css("display","block");if(C="",e(".mhc_select_module_tabs input").each(function(){var t=e(this);t.is(":checked")&&(C+=""!==C?","+t.val():t.val())}),"all"!==(C="general,advanced,css"===C?"all":C)){var T="",P=C.split(","),A=o.model.attributes;_.each(P,function(e){switch(e){case"general":T+=".mhc-options-tab-general input, .mhc-options-tab-general select, .mhc-options-tab-general textarea";break;case"advanced":T+=""!==T?",":"",T+=".mhc-options-tab-advanced input, .mhc-options-tab-advanced select, .mhc-options-tab-advanced textarea";break;case"css":T+=""!==T?",":"",T+=".mhc-options-tab-custom_css input, .mhc-options-tab-custom_css select, .mhc-options-tab-custom_css textarea"}}),_.each(A,function(e,t){-1!==t.indexOf("mhc_")&&o.model.unset(t,{silent:!0})})}o.model.set("mhc_saved_tabs",C,{silent:!0})}e(".layout_cats_container input").is(":checked")&&e(".layout_cats_container input").each(function(){var t=e(this);t.is(":checked")&&(S+=""!==S?","+t.val():t.val())}),o.performSaving(T),b=F.generateCompleteShortcode(y,f,V,x),"row_inner"===u&&(b=(b=b.replace(/mhc_row_inner/g,"mhc_row")).replace(/mhc_column_inner/g,"mhc_column")),"all"!==C&&o.performSaving(),H.addClass("mhc_modal_closing"),O.addClass("mhc_overlay_closing"),setTimeout(function(){H.remove(),O.remove(),e("body").removeClass("mhc_stop_scroll")},600),e.ajax({type:"POST",url:mhc_options.ajaxurl,dataType:"json",data:{action:"mhc_save_layout",mh_admin_load_nonce:mhc_options.mh_admin_load_nonce,mh_layout_name:h,mh_layout_content:b,mh_layout_scope:m,mh_layout_type:f,mh_module_width:w,mh_columns_layout:s,mh_selected_tabs:C,mh_module_type:u,mh_layout_cats:S,mh_layout_new_cat:$,mh_post_type:mhc_options.post_type},beforeSend:function(t){"shared"===m&&(e("body").find(".mhc_shared_loading_overlay").length||e("body").append('<div class="mhc_shared_loading_overlay"></div>'))},success:function(t){if("shared"===m){F.collection.find(function(e){return e.get("cid")==y}).set("mhc_shared_module",t.post_id),"ignore_shared"===V&&g.length&&g.each(function(){var t=e(this).data("cid");if(void 0!==t&&""!==t){var i=F.collection.find(function(e){return e.get("cid")==t});i.unset("mhc_shared_module"),i.unset("mhc_saved_tabs")}}),M(),setTimeout(function(){e("body").find(".mhc_shared_loading_overlay").remove()},650)}}})}r(e(this))}),e(".mhc_modal_overlay .mhc_prompt_dont_proceed").click(function(t){t.preventDefault(),r(e(this))})}function c(e){e.addClass("mhc_animate_clone"),setTimeout(function(){e.length&&e.removeClass("mhc_animate_clone")},500)}function r(t){var i=t.closest(".mhc_modal_overlay");e("body").removeClass("mhc_stop_scroll"),i.addClass("mhc_modal_closing"),setTimeout(function(){i.remove()},600)}function h(t,i){t.removeOverlay(),e(".mhc_modal_settings_container").addClass("mhc_modal_closing"),setTimeout(function(){t.remove(),"trigger_event"===i&&E.trigger("mh-modal-view-removed")},600)}function m(){if(te.filter(":visible").length>1?(ie.find(".mhc_page_layout_settings").hide(),ie.find(".mhc_side_nav_settings").show()):("post"!==mhc_options.post_type&&ie.closest("#mh_settings_meta_box").find(".mhc_page_layout_settings").hide(),ie.closest("#mh_settings_meta_box").find(".mhc_side_nav_settings").show()),Z.length){Z.hide();var t=Z.find('input[type="radio"]:checked').val();e(".mh_mharty_format_setting.mh_mharty_"+t+"_settings").hide()}}function p(t,i){var o,i=void 0!==i&&i;return o=void 0!==window.tinyMCE&&window.tinyMCE.get(t)&&!window.tinyMCE.get(t).isHidden()?window.tinyMCE.get(t).getContent():e("#"+t).val(),i&&void 0!==window.tinyMCE&&(o=(o=o.replace(/<p>\[/g,"[")).replace(/\]<\/p>/g,"]")),o.trim()}function u(){var e="tinymce";return"html"===getUserSetting("editor")&&(e="html"),e}function g(e){return!(void 0===window.tinyMCE||!window.tinyMCE.get(e)||window.tinyMCE.get(e).isHidden())}function v(t,i,o){g("content");var n=g(t),s=e.trim(i);if(void 0!==window.tinyMCE&&window.tinyMCE.get(t)&&n){window.tinyMCE.get(t).setContent(s,{format:"html"})}else e("#"+t).val(s);le[t]||"content"===t||(void 0!==tinyMCEPreInit.mceInit[t]?quicktags({id:t}):quicktags(tinyMCEPreInit.qtInit[t]),QTags._buttonsInit(),le[t]=!0),wp.heartbeat&&wp.heartbeat.hasConnectionError()||(e("#publish").removeClass("disabled"),delete F.disable_publish)}function f(e){void 0!==window.tinyMCE&&(window.tinyMCE.execCommand("mceRemoveEditor",!1,e),void 0!==window.tinyMCE.get(e)&&window.tinyMCE.remove("#"+e),le[e]=!1)}function w(t){t.length&&t.each(function(){e(this).trigger("change")})}function y(t,i){var o=t.find(".mhc-options-tabs-links"),n=t.find(".mhc-options-tab"),s=t.find(".mhc-affects"),a=t.find(".mhc-validate-unit"),l=t.find(".mhc-range"),d=t.find(".mhc-range-input"),c=t.find(".mhc-options-tab-advanced"),r=c.find(".mhc-main-setting"),h=t.find(".mhc-custom-color-picker"),m=t.find(".mhc-choose-custom-color-button"),_=t.find(".mhc_switch_button_wrapper"),p=t.find(".mhc_switch_button"),u=t.find("select"),g=t.find(".mhc-options-tab-custom_css .mhc-option"),v=t.find(".mhc_checkboxes_wrapper"),f=v.find('input[type="checkbox"]'),y=t.find("#mhc_google_api_key"),S=t.find(".mhc_update_google_key");y.length&&(S.attr("href",mhc_options.theme_panel_advanced),""===mhc_options.google_api_key?(y.addClass("mhc_hidden_field"),S.text(S.data("empty_text")).addClass("mhc_no_field_visible")):y.val(mhc_options.google_api_key)),v.length&&v.each(function(){var t,i,o=e(this),n=o.find("input.mhc-main-setting").val(),s=o.find('input[type="checkbox"]');""!==n&&(t=n.split("|"),i=0,s.each(function(){if("on"===t[i]){e(this).prop("checked",!0)}i++}))}),f.click(function(){var t,i,o=e(this),n=e(this).attr("class"),s=o.closest(".mhc_checkboxes_wrapper"),a=s.find('input[type="checkbox"]'),l=s.find("input.mhc-main-setting"),d=!0===o.prop("checked")?"on":"off",c=0,r=[];a.each(function(){e(this).hasClass(n)&&(t=c),c++,r.push("")}),(i=""!==l.val()?l.val().split("|"):r)[t]=d,l.val(i.join("|"))}),void 0!==window.switchEditors&&t.find(".wp-switch-editor").click(function(){var t;P(t=e(this).hasClass("switch-tmce")?"tinymce":"html"),window.switchEditors.go("content",t)}),h.each(function(){var t=e(this),i=t.val(),o=t.closest(".mhc-custom-color-container"),n=o.siblings(".mhc-choose-custom-color-button"),s=o.find(".mhc-color-picker-hex");if(""===i)return!0;o.removeClass("mhc_hidden"),n.addClass("mhc_hidden"),s.wpColorPicker("color",i)}),m.click(function(){var t=e(this),i=t.siblings(".mhc-custom-color-container"),o=i.find(".mhc-color-picker-hex"),n=i.find(".mhc-custom-color-picker");return t.addClass("mhc_hidden"),i.removeClass("mhc_hidden"),n.val(o.wpColorPicker("color")),!1}),_.each(function(){var t=e(this),i=t.find(".mhc_switch_button");"on"===t.find("select").val()?(i.removeClass("mhc_off_state"),i.addClass("mhc_on_state")):(i.removeClass("mhc_on_state"),i.addClass("mhc_off_state"))}),p.click(function(){var t=e(this),i=t.closest(".mhc_switch_button_wrapper").find("select");t.hasClass("mhc_off_state")?(t.removeClass("mhc_off_state"),t.addClass("mhc_on_state"),i.val("on")):(t.removeClass("mhc_on_state"),t.addClass("mhc_off_state"),i.val("off")),i.trigger("change")}),u.change(function(){var t=e(this),i=t.closest(".mhc_switch_button_wrapper").find(".mhc_switch_button");"on"===t.val()?(i.removeClass("mhc_off_state"),i.addClass("mhc_on_state")):(i.removeClass("mhc_on_state"),i.addClass("mhc_off_state"))}),o.find("li a").click(function(){var t=e(this),i=t.closest("li").index(),n=t.closest("ul"),s=n.siblings(".mhc-options-tabs"),a=n.find(".mhc-options-tabs-links-active"),l=a.index(),d=s.find(".mhc-options-tab").eq(l),c=s.find(".mhc-options-tab").eq(i);return l!==i&&(c.css({display:"none",opacity:0}),d.css({display:"block",opacity:1}).stop(!0,!0).animate({opacity:0},300,function(){e(this).css("display","none"),c.css({display:"block",opacity:0}).stop(!0,!0).animate({opacity:1},300,function(){var t=e(this);t.find(".mhc-option:visible").length?e(".mhc-all-options-hidden").remove():t.append('<p class="mhc-all-options-hidden">'+mhc_options.all_tab_options_hidden+"<p>"),o.trigger("mhc_main_tab:changed")})}),a.removeClass("mhc-options-tabs-links-active"),n.find("li").eq(i).addClass("mhc-options-tabs-links-active"),e(".mhc-options-tabs").animate({scrollTop:0},400,"swing")),!1}),n.each(function(){var t=e(this).find(".mhc-options-toggle-enabled"),i="mhc-option-toggle-content-open";t.find("h3").click(function(){var o=e(this),n=o.siblings(".mhc-option-toggle-content"),a=o.closest(".mhc-options-toggle-container"),l=t.filter("."+i),d=l.find(".mhc-option-toggle-content");a.hasClass(i)||(l.removeClass(i).addClass("mhc-option-toggle-content-closed"),d.slideToggle(300),a.removeClass("mhc-option-toggle-content-closed").addClass(i),n.slideToggle(300,function(){w(s)}))})}),l.on("input change",function(){var t,i,o=e(this),n=o.val(),s=o.siblings(".mhc-range-input"),a=s.data("initial_value_set")||!1,l=C(e.trim(s.val()),!1,"no_default_unit");if(""===l&&!a)return o.val(0),void s.data("initial_value_set",!0);t=parseFloat(l),l+="",""!==(i=e.trim(l.replace(t,"")))&&(n+=i),s.val(n)}),l.length&&l.each(function(){var t=e(this),i=e.trim(t.data("default")),o=t.siblings(".mhc-range-input");""===e.trim(o.val())&&(""!==i&&(o.val(i),i=parseFloat(i)||0),t.val(i))}),d.on("keyup change",function(){var t,i=e(this),o=i.val(),n=i.siblings(".mhc-range");t=parseFloat(o)||0,n.val(t).trigger("mhc_setting:change")}),a.length&&a.each(function(){var t=e(this),i=C(e.trim(t.val()));t.val(i)}),r.length&&(r.on("change mhc_setting:change mh_main_custom_margin:change",function(){var t=e(this),i=t.closest(".mhc-option-container").find(".mhc-reset-setting"),o=b(t),n=t.hasClass("mhc-range"),s=n?t.siblings(".mhc-range-input"):t,a=s.val();s.is("select")&&""===o&&0===s.prop("selectedIndex")?i.removeClass("mhc-reset-icon-visible"):a!==o&&!n||n&&a!==o+"px"&&a!==o?setTimeout(function(){i.addClass("mhc-reset-icon-visible")},50):i.removeClass("mhc-reset-icon-visible")}),r.trigger("change")),c.find(".mhc-reset-setting").click(function(){k(e(this))}),s.length&&(s.change(function(){var t=e(this),i=t.val(),o=(parseInt(i),e(t.data("affects"))),n=t.closest(".mhc-options-tab").index();o.each(function(){var o=e(this),s=o.closest(".mhc-option"),a="text"===t.attr("type")&&void 0===d&&void 0===l,l=s.data("depends_show_if")||"on",d=a?"":s.data("depends_show_if_not"),c=l===i||void 0!==d&&d!==i,r=o.closest(".mhc-options-tab").index(),h=s.find(".mhc-affects");if((!a||t.is(":visible"))&&(n===r&&c&&!t.is(":visible")&&(c=!1),s.toggle(c).addClass("mhc_animate_affected"),setTimeout(function(){s.removeClass("mhc_animate_affected")},500),h.length)){var m=e(h.data("affects"));s.is(":visible")?o.trigger("change"):m.each(function(){e(this).closest(".mhc-option").hide()})}})}),setTimeout(function(){n.css({display:"block"}),w(s),n.css({display:"none"}),D()},100)),t.find(".mhc-options-tabs-links").on("mhc_main_tab:changed",function(){var t,o=e(".mhc-options-tabs-links").find(".mhc_options_tab_custom_css"),n=e(".mhc-options-tab-custom_css").find(".mhc_module_order_placeholder");if(o.hasClass("mhc-options-tabs-links-active")){var s;t=void 0!==(s=j.findWhere({cid:i})).attributes.module_order?s.attributes.module_order:"",n.length&&n.replaceWith(t)}}),g.length&&g.focusin(function(){var t=e(this).closest(".mhc-option"),i=t.find("label > span"),o=t.siblings().find("label > span");i.length&&(i.removeClass("mhc_hidden_css_selector"),i.css({display:"inline-block"}),i.addClass("mhc_visible_css_selector")),o.length&&(o.removeClass("mhc_visible_css_selector"),o.addClass("mhc_hidden_css_selector"),setTimeout(function(){o.css({display:"none"}),o.removeClass("mhc_hidden_css_selector")},200))})}function b(e){var t,i=e.hasClass("mhc-color-picker-hex")?"default-color":"default";return t=void 0!==e.data(i)?e.data(i):"",t+=""}function k(e){var t=e,i=t.closest(".mhc-option-container"),o=i.find(".mhc-main-setting"),n=b(o);if(o.is("select")&&""===n)o.prop("selectedIndex",0).trigger("change");else if(o.hasClass("mhc-custom-color-picker"))!function(e){var t=e.closest(".mhc-custom-color-container"),i=t.siblings(".mhc-choose-custom-color-button"),o=t.find(".mhc-custom-color-picker");i.removeClass("mhc_hidden"),t.addClass("mhc_hidden"),o.val("")}(t);else{if(o.hasClass("mhc-color-picker-hex"))return o.wpColorPicker("color",n),""===n&&o.siblings(".wp-picker-clear").trigger("click"),t.hasClass("mhc-reset-setting")||(t=i.find(".mhc-reset-setting")),void t.hide();o.hasClass("mhc-range")&&(n=b(o=t.siblings(".mhc-range-input"))),o.val(n),o.data("has_saved_value","no"),o.trigger("change")}}function C(t,i,o){var n,s="!important".length,a=!1,l=(t=void 0===t?"":t).length,i=!_.isUndefined(i)&&i;if(""===t)return"";if("!important"===t.substr(0-s,s)&&(a=!0,l-=s,t=t.substr(0,l).trim()),-1!==e.inArray(t.substr(-1,1),["%"]))return d=parseFloat(t)+"%",a&&!i&&(d+=" !important"),d;if(-1!==e.inArray(t.substr(-2,2),["em","px","cm","mm","in","pt","pc","ex","vh","vw"])){var d=parseFloat(t)+t.substr(-2,2);return a&&!i&&(d+=" !important"),d}return isNaN(parseFloat(t))?"":(n=parseFloat(t),(_.isUndefined(o)||"no_default_unit"!==o)&&(n+="px"),n)}function S(t){t.$(".mhc-color-picker-hex:visible").each(function(){e(this).closest(".wp-picker-container").find(".wp-color-result").trigger("click")})}function $(){mhc_options.debug&&window.console&&(2===arguments.length?console.log(arguments[0],arguments[1]):console.log(arguments[0]))}function M(){F.saveAsShortcode(),setTimeout(function(){var t=e("#mhc_layout"),i=t.innerHeight();t.css({height:i}),content=p("content",!0),F.removeAllSections(),F.$el.find(".mhc_section").remove(),F.createLayoutFromContent(V(content),"","",{is_reinit:"reinit"}),t.css({height:"auto"})},600)}function V(e){if(-1!==e.indexOf("[mhc_"))if(-1===e.indexOf("mhc_row")&&-1===e.indexOf("mhc_section"))if(-1===e.indexOf("mhc_fullwidth")){e='[mhc_section template_type="module" skip_module="true"][mhc_row template_type="module" skip_module="true"][mhc_column type="4_4" saved_tabs="'+(t=/(\\?")(.*?)\1/.exec(e))[2]+'"]'+e+"[/mhc_column][/mhc_row][/mhc_section]"}else{var t=/(\\?")(.*?)\1/.exec(e);e='[mhc_section fullwidth="on" template_type="module" skip_module="true" saved_tabs="'+t[2]+'"]'+e+"[/mhc_section]"}else-1===e.indexOf("mhc_section")&&(e='[mhc_section template_type="row" skip_module="true"]'+e+"[/mhc_section]");return e}function x(t,i,o,n,s,a,l,d){if(void 0!==oe[o+"_"+(i=""===i?"not_shared":i)+"_"+s+"_"+a]){var c=new MH_PageComposer.SavedTemplates(oe[o+"_"+i+"_"+s+"_"+a]),r=new MH_PageComposer.TemplatesView({collection:c,category:l});n.append(r.render().el),"include_shared"===t&&"not_shared"===i?x("include_shared","shared",o,n,s,a,l):(E.trigger("mhc-loading:ended"),n.prepend(H(l)),e("#mhc_select_category").data("attr",{include_shared:t,is_shared:"",layout_type:o,append_to:n,module_width:s,specialty_cols:a}))}else e.ajax({type:"POST",url:mhc_options.ajaxurl,dataType:"json",data:{action:"mhc_get_saved_templates",mh_admin_load_nonce:mhc_options.mh_admin_load_nonce,mh_is_shared:i,mh_post_type:mhc_options.post_type,mh_layout_type:o,mh_module_width:s,mh_specialty_columns:a},beforeSend:function(){E.trigger("mhc-loading:started")},complete:function(){("include_shared"!==t||"include_shared"===t&&"shared"===i)&&(E.trigger("mhc-loading:ended"),n.prepend(H(l)),e("#mhc_select_category").data("attr",{include_shared:t,is_shared:"",layout_type:o,append_to:n,module_width:s,specialty_cols:a}))},success:function(e){var c="";if(void 0!==e.error)("include_shared"===t&&"shared"===i&&"success"!==d||"include_shared"!==t)&&(n.append("<ul><li>"+e.error+"</li></ul>"),c="fail");else{var r=new MH_PageComposer.SavedTemplates(e),h=new MH_PageComposer.TemplatesView({collection:r});oe[o+"_"+i+"_"+s+"_"+a]=e,n.append(h.render().el),c="success"}"include_shared"===t&&"not_shared"===i&&x("include_shared","shared",o,n,s,a,l,c)}})}function H(t){var i=e.parseJSON(mhc_options.layout_categories),o='<select id="mhc_select_category">',n="all"===t||""===t?" selected":"";return o+='<option value="all"'+n+">"+mhc_options.all_cat_text+"</option>",e.isEmptyObject(i)||e.each(i,function(i,s){e.isEmptyObject(s)||(n=t===s.slug?" selected":"",o+='<option value="'+s.slug+'"'+n+">"+s.name+"</option>")}),o+="</select>"}function O(t,i,o,n){void 0!==oe[t+"_layouts"]?o.find(".mhc-main-settings."+i).append(oe[t+"_layouts"]):e.ajax({type:"POST",url:mhc_options.ajaxurl,data:{action:"mhc_show_all_layouts",mh_layouts_built_for_post_type:n,mh_admin_load_nonce:mhc_options.mh_admin_load_nonce,mh_load_layouts_type:t},beforeSend:function(){E.trigger("mhc-loading:started")},complete:function(){E.trigger("mhc-loading:ended")},success:function(e){o.find(".mhc-main-settings."+i).append(e),oe[t+"_layouts"]=e}})}function T(t,i,o){if(!t.hasClass("mhc-options-tabs-links-active")){var n=void 0!==t.closest(".mhc-options-tabs-links").data("specialty_columns")?t.closest(".mhc-options-tabs-links").data("specialty_columns"):0;if(e(".mhc-options-tabs-links li").removeClass("mhc-options-tabs-links-active"),t.addClass("mhc-options-tabs-links-active"),e(".mhc-main-settings.active-container").css({display:"block",opacity:1}).stop(!0,!0).animate({opacity:0},300,function(){e(this).css("display","none"),e(this).removeClass("active-container"),e("."+t.data("open_tab")).addClass("active-container").css({display:"block",opacity:0}).stop(!0,!0).animate({opacity:1},300)}),void 0===t.data("content_loaded")&&!t.hasClass("mhc-new-module")&&"layout"!==i){x(t.closest(".mhc_modal_settings").hasClass("mhc_no_shared")?"no_shared":"include_shared","",i,e("."+t.data("open_tab")),o,n,"all"),t.data("content_loaded","true")}}}function P(e,t){if(void 0!==window.switchEditors){var i=tinyMCEPreInit.mceInit.mhc_content_new.tadv_noautop;_.each(F.collection.models,function(o){var n=o.get("mhc_content_new");if(void 0!==n){if("tinymce"===e)n=window.switchEditors.wpautop(n.replace(/<p>Â <\/p>/g,"<p>&nbsp;</p>"));else{if(void 0!==i&&!0===i)return;if(!_.isUndefined(t)&&"initial_load"===t)return;n=window.switchEditors.pre_wpautop(n)}o.set("mhc_content_new",n,{silent:!0})}})}}function A(t,i){var o=mhc_options.template_post_id;e.ajax({type:"POST",url:mhc_options.ajaxurl,data:{action:"mhc_add_template_meta",mh_admin_load_nonce:mhc_options.mh_admin_load_nonce,mh_meta_value:i,mh_custom_field:t,mh_post_id:o}})}function R(t){var i=z.getView(t),o=i.model.get("mhc_shared_module"),n=i.model.get("type");layout_type_updated="row_inner"===n?"row":n,template_shortcode=F.generateCompleteShortcode(t,layout_type_updated,"ignore_shared"),"row_inner"===n&&(template_shortcode=template_shortcode.replace(/mhc_row_inner/g,"mhc_row"),template_shortcode=template_shortcode.replace(/mhc_column_inner/g,"mhc_column")),e.ajax({type:"POST",url:mhc_options.ajaxurl,data:{action:"mhc_update_layout",mh_admin_load_nonce:mhc_options.mh_admin_load_nonce,mh_layout_content:template_shortcode,mh_template_post_id:o}})}function D(){var t=e(".mhc_modal_settings_container");e(".mhc_modal_settings_container").hasClass("mhc_hide_general_tab")?(t.find(".mhc-options-tabs-links li").removeClass("mhc-options-tabs-links-active"),t.find(".mhc-options-tabs .mhc-options-tab").css({display:"none",opacity:0}),t.hasClass("mhc_hide_advanced_tab")?(t.find(".mhc-options-tabs-links li.mhc_options_tab_custom_css").addClass("mhc-options-tabs-links-active"),t.find(".mhc-options-tabs .mhc-options-tab.mhc-options-tab-custom_css").css({display:"block",opacity:1})):(t.find(".mhc-options-tabs-links li.mhc_options_tab_advanced").addClass("mhc-options-tabs-links-active"),t.find(".mhc-options-tabs .mhc-options-tab.mhc-options-tab-advanced").css({display:"block",opacity:1}))):t.find(".mhc-options-tabs .mhc-options-tab.mhc-options-tab-general").css({display:"block",opacity:1})}function I(){return e.ajax({type:"POST",url:mhc_options.ajaxurl,dataType:"json",data:{action:"mhc_current_user_can_lock",mh_admin_load_nonce:mhc_options.mh_admin_load_nonce},beforeSend:function(){E.trigger("mhc-loading:started")},complete:function(){E.trigger("mhc-loading:ended")}})}function N(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}function L(){return"undefined"!=typeof YoastSEO&&"object"==typeof YoastSEO}_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},MH_PageComposer.Module=Backbone.Model.extend({defaults:{type:"element"}}),MH_PageComposer.SavedTemplate=Backbone.Model.extend({defaults:{title:"template",ID:0,shortcode:"",is_shared:"false",layout_type:"",module_type:"",categories:[]}}),MH_PageComposer.History=Backbone.Model.extend({defaults:{timestamp:_.now(),shortcode:"",current_active_history:!1,verb:"did",noun:"something"},max_history_limit:100,validate:function(e,t){t.collection.length;var i=t.collection.findWhere({current_active_history:!0}),o=e.shortcode,n=_.isUndefined(i)?t.collection.at(t.collection.length-1):i;if(o===(!_.isUndefined(n)&&n.get("shortcode")))return"duplicate";F.enable_history=!1;var s=t.collection.models.length-(this.max_history_limit-1);if(s>0)for(var a=1;a<=s;a++)t.collection.shift()}}),MH_PageComposer.Layout=Backbone.Model.extend({defaults:{moduleNumber:0,forceRemove:!1,modules:e.parseJSON(mhc_options.mh_composer_modules),views:[]},initialize:function(){_.each(this.get("modules"),function(e){e.title=e.title.replace(/%%/g,'"'),e.title=e.title.replace(/\|\|/g,"'")})},addView:function(e,t){var i=this.get("views");i[e]=t,this.set({views:i})},getView:function(e){return this.get("views")[e]},getChildViews:function(e){var t=this.get("views"),i={};return _.each(t,function(t,o){void 0!==t&&t.model.attributes.parent===e&&(i[o]=t)}),i},getChildrenViews:function(e){var t,i=this,o=i.get("views"),n={};return _.each(o,function(o,s){void 0!==o&&o.model.attributes.parent===e&&(t=i.getChildrenViews(o.model.attributes.cid),_.isEmpty(t)||_.extend(n,t),n[s]=o)}),n},getParentViews:function(e){for(var t=this.getView(e),i={};!_.isUndefined(t);)i[t.model.attributes.cid]=t,t=this.getView(t.model.attributes.parent);return i},getSectionView:function(e){var t,i=this.getParentViews(e);return t=_.filter(i,function(e){return"section"===e.model.attributes.type}),!_.isUndefined(t[0])&&t[0]},setNewParentID:function(e,t){var i=this.get("views");i[e].model.attributes.parent=t,this.set({views:i})},removeView:function(e){var t=this.get("views"),i={};_.each(t,function(t,o){o!=e&&(i[o]=t)}),this.set({views:i})},generateNewId:function(){var e=this.get("moduleNumber")+1;return this.set({moduleNumber:e}),e},generateTemplateName:function(t){return-1!==e.inArray(t,["row","row_inner","section","column","column_inner"])&&(t="mhc_"+t),"#mh-composer-"+t+"-module-template"},getModuleOptionsNames:function(e){var t=this.get("modules");return this.addAdminLabel(_.findWhere(t,{label:e}).options)},getNumberOf:function(e,t){var i=this.get("views"),o=0;return _.each(i,function(i){if(void 0!==i){var n=i.model.attributes.type;i.model.attributes.parent!==t||n!==e&&n!==e+"_inner"||o++}}),o},getNumberOfModules:function(e){var t=this.get("views"),i=0;return _.each(t,function(t){void 0!==t&&t.model.attributes.type===e&&i++}),i},getTitleByShortcodeTag:function(e){var t=this.get("modules");return _.findWhere(t,{label:e}).title},isModuleFullwidth:function(e){var t=this.get("modules");return"on"===_.findWhere(t,{label:e}).fullwidth_only},isChildrenLocked:function(e){var t=this.getChildrenViews(e),i=!1;return _.each(t,function(e){"on"!==e.model.get("mhc_locked")&&"on"!==e.model.get("mhc_parent_locked")||(i=!0)}),i},addAdminLabel:function(e){return _.union(e,["admin_label"])},removeSharedAttributes:function(e,t){var i=this,t=!_.isUndefined(t)&&t,o=_.isUndefined(e.model.attributes.shared_parent_cid)?e.model.attributes.cid:e.model.attributes.shared_parent_cid,n=this.getView(o);shared_item_children_views=this.getChildrenViews(o),this.is_shared(n.model)&&(t&&n.model.set("mhc_temp_shared_module",n.model.get("mhc_shared_module")),n.model.unset("mhc_shared_module")),_.each(shared_item_children_views,function(e){i.is_shared_children(e.model)&&(t&&e.model.set("mhc_temp_shared_parent",e.model.get("mhc_shared_parent")),e.model.unset("mhc_shared_parent")),i.has_shared_parent_cid(e.model)&&(t&&e.model.set("mhc_temp_shared_parent_cid",e.model.get("shared_parent_cid")),e.model.unset("shared_parent_cid"))})},removeTemporarySharedAttributes:function(e,t){var i=this,t=!_.isUndefined(t)&&t,o=(_.isUndefined(e.model.attributes.mhc_temp_shared_module)?j.findWhere({mhc_temp_shared_module:e.model.attributes.mhc_temp_shared_parent}):e.model).attributes.cid,n=z.getView(o);shared_item_children_views=z.getChildrenViews(o),this.is_temp_shared(n.model)&&(t&&n.model.set("mhc_shared_module",n.model.get("mhc_temp_shared_module")),n.model.unset("mhc_temp_shared_module")),_.each(shared_item_children_views,function(e){i.is_temp_shared_children(e.model)&&(t&&e.model.set("mhc_shared_parent",e.model.get("mhc_temp_shared_parent")),e.model.unset("mhc_temp_shared_parent")),i.has_temp_shared_parent_cid(e.model)&&(t&&e.model.set("shared_parent_cid",e.model.get("mhc_temp_shared_parent_cid")),e.model.unset("mhc_temp_shared_parent_cid"))}),t&&R(o)},is_app:function(e){return"app"===e.attributes.type},is_shared:function(e){return!this.is_app(e)&&!(!e.has("mhc_shared_module")||""===e.get("mhc_shared_module"))},is_shared_children:function(e){return!this.is_app(e)&&!(!e.has("mhc_shared_parent")||""===e.get("mhc_shared_parent"))},has_shared_parent_cid:function(e){return!(!e.has("shared_parent_cid")||""===e.get("shared_parent_cid"))},is_temp_shared:function(e){return!(!e.has("mhc_temp_shared_module")||""===e.get("mhc_temp_shared_module"))},is_temp_shared_children:function(e){return!(!e.has("mhc_temp_shared_parent")||""===e.get("mhc_temp_shared_parent"))},has_temp_shared_parent_cid:function(e){return!(!e.has("mhc_temp_shared_parent_cid")||""===e.get("mhc_temp_shared_parent_cid"))}}),MH_PageComposer.Modules=Backbone.Collection.extend({model:MH_PageComposer.Module}),MH_PageComposer.SavedTemplates=Backbone.Collection.extend({model:MH_PageComposer.SavedTemplate}),MH_PageComposer.Histories=Backbone.Collection.extend({model:MH_PageComposer.History}),MH_PageComposer.TemplatesView=window.wp.Backbone.View.extend({className:"mhc_saved_layouts_list",tagName:"ul",render:function(){var t="",i=void 0===this.options.category?"all":this.options.category;return this.collection.each(function(o){if("all"===i||-1!==e.inArray(i,o.get("categories"))){var n=new MH_PageComposer.SingleTemplateView({model:o});this.$el.append(n.el),t=void 0!==n.model.get("is_shared")&&"shared"===n.model.get("is_shared")?"shared":""}},this),"shared"===t&&this.$el.addClass("mhc_shared"),this}}),MH_PageComposer.SingleTemplateView=window.wp.Backbone.View.extend({tagName:"li",template:_.template(e("#mh-composer-saved-entry").html()),events:{click:"insertSection"},initialize:function(){this.render()},render:function(){this.$el.html(this.template(this.model.toJSON())),void 0!==this.model.get("module_type")&&""!==this.model.get("module_type")&&"module"===this.model.get("layout_type")&&this.$el.addClass(this.model.get("module_type"))},insertSection:function(t){var i=e(t.target),o=void 0!==i.closest(".mhc_modal_settings").data("parent_cid")?i.closest(".mhc_modal_settings").data("parent_cid"):"",n=void 0!==e(".mhc-settings-heading").data("current_row")?e(".mhc-settings-heading").data("current_row"):"",s="shared"===this.model.get("is_shared")?this.model.get("ID"):"",a=void 0!==e(".mhc-saved-modules-switcher").data("specialty_columns")?"on":"off",l=this.model.get("shortcode"),d=!1,c="row"===this.model.get("layout_type")?n:o,r=z.getView(c),h="row_inner"===this.options.model.get("layout_type")?"saved_row":"saved_"+this.options.model.get("layout_type");"on"===a&&(c=r.model.get("parent"),r=z.getView(c)),"section"!==this.model.get("layout_type")&&(void 0!==r.model.get("shared_parent_cid")&&""!==r.model.get("shared_parent_cid")||void 0!==r.model.get("mhc_shared_module")&&""!==r.model.get("mhc_shared_module"))&&(d=!0),F.allowHistorySaving("added",h),t.preventDefault(),F.createLayoutFromContent(l,o,"",{ignore_template_tag:"ignore_template",current_row_cid:n,shared_id:s,after_section:o,is_reinit:"reinit"}),M(),!0===d&&(shared_module_cid=void 0!==r.model.get("shared_parent_cid")?r.model.get("shared_parent_cid"):c,R(shared_module_cid))}}),MH_PageComposer.TemplatesModal=window.wp.Backbone.View.extend({className:"mhc_modal_settings",template:_.template(e("#mh-composer-load_layout-template").html()),events:{"click .mhc-options-tabs-links li a":"switchTab"},render:function(){return this.$el.html(this.template({display_switcher:"off"})),this.$el.addClass("mhc_modal_no_tabs"),this},switchTab:function(t){var i=e(t.currentTarget).parent();t.preventDefault(),T(i,"section","")}}),MH_PageComposer.SectionView=window.wp.Backbone.View.extend({className:"mhc_section",template:_.template(e("#mh-composer-section-template").html()),events:{"click .mhc-settings-section":"showSettings","click .mhc-clone-section":"cloneSection","click .mhc-remove-section":"removeSection","click .mhc-section-add-main":"addSection","click .mhc-section-add-fullwidth":"addFullwidthSection","click .mhc-section-add-specialty":"addSpecialtySection","click .mhc-section-add-saved":"addSavedSection","click .mhc-expand":"expandSection","contextmenu .mhc-section-add":"showRightClickOptions","click.mhc_section > .mhc-controls .mhc-unlock":"unlockSection","contextmenu.mhc_section > .mhc-controls":"showRightClickOptions","contextmenu.mhc_row > .mhc-right-click-trigger-overlay":"showRightClickOptions","click.mhc_section > .mhc-controls":"hideRightClickOptions","click.mhc_row > .mhc-right-click-trigger-overlay":"hideRightClickOptions","click > .mhc-locked-overlay":"showRightClickOptions","contextmenu > .mhc-locked-overlay":"showRightClickOptions"},initialize:function(){this.child_views=[],this.listenTo(this.model,"change:admin_label",this.renameModule),this.listenTo(this.model,"change:mhc_disabled",this.toggleDisabledClass)},render:function(){return this.$el.html(this.template(this.model.toJSON())),"on"===this.model.get("mhc_specialty")&&(this.$el.addClass("mhc_section_specialty"),"true"===this.model.get("mhc_specialty_placeholder")&&this.$el.addClass("mhc_section_placeholder")),(void 0!==this.model.get("mhc_shared_module")||void 0!==this.model.get("mhc_template_type")&&"section"===this.model.get("mhc_template_type")&&"shared"===mhc_options.is_shared_template)&&this.$el.addClass("mhc_shared"),void 0!==this.model.get("mhc_disabled")&&"on"===this.model.get("mhc_disabled")&&this.$el.addClass("mhc_disabled"),void 0!==this.model.get("mhc_locked")&&"on"===this.model.get("mhc_locked")&&this.$el.addClass("mhc_locked"),void 0!==this.model.get("mhc_collapsed")&&"on"===this.model.get("mhc_collapsed")&&this.$el.addClass("mhc_collapsed"),void 0!==this.model.get("pasted_module")&&this.model.get("pasted_module")&&c(this.$el),_.isUndefined(this.model.get("mhc_temp_shared_module"))||this.$el.addClass("mhc_shared_temp"),this.makeRowsSortable(),this},showSettings:function(t){var i,o=this,n=void 0!==t?e(t.currentTarget):"",s={model:this.model,collection:this.collection,attributes:{"data-open_view":"module_settings"},triggered_by_right_click:this.triggered_by_right_click,do_preview:this.do_preview};if(void 0!==t&&t.preventDefault(),!this.isSectionLocked()){if(""!==n&&n.closest(".mhc_section_specialty").length){var a=n.closest(".mhc_section_specialty").find(".mhc-section-content > .mhc-column"),l="";a.length&&a.each(function(){l+=""===l?"1_1":",1_1"}),s.model.attributes.columns_layout=l}if(i=new MH_PageComposer.ModalView(s),mh_modal_view_rendered=i.render(),!1===mh_modal_view_rendered)return setTimeout(function(){o.showSettings()},500),void E.trigger("mhc-loading:started");if(E.trigger("mhc-loading:ended"),e("body").append(mh_modal_view_rendered.el),"on"===this.model.get("mhc_fullwidth")&&e(".mhc_modal_settings_container").addClass("section_fullwidth"),"on"===this.model.get("mhc_specialty")&&e(".mhc_modal_settings_container").addClass("section_specialty"),"on"!==this.model.get("mhc_specialty")&&"on"!==this.model.get("mhc_fullwidth")&&e(".mhc_modal_settings_container").addClass("section_regular"),void 0!==i.model.get("mhc_shared_module")&&""!==i.model.get("mhc_shared_module")||void 0!==this.model.get("mhc_template_type")&&"section"===this.model.get("mhc_template_type")&&"shared"===mhc_options.is_shared_template){e(".mhc_modal_settings_container").addClass("mhc_saved_shared_modal");_.each(["general","advanced","custom_css"],function(t){e(".mhc_options_tab_"+t).addClass("mhc_saved_shared_tab")})}D()}},addSection:function(e){var t=z.generateNewId();e.preventDefault(),i(),F.allowHistorySaving("added","section"),this.collection.add([{type:"section",module_type:"section",mhc_fullwidth:"off",mhc_specialty:"off",cid:t,view:this,created:"auto",admin_label:mhc_options.noun.section}])},addFullwidthSection:function(e){var t=z.generateNewId();e.preventDefault(),i(),F.allowHistorySaving("added","fullwidth_section"),this.collection.add([{type:"section",module_type:"section",mhc_fullwidth:"on",mhc_specialty:"off",cid:t,view:this,created:"auto",admin_label:mhc_options.noun.section}])},addSpecialtySection:function(t){var o=z.generateNewId(),n=e(t.target),s=void 0!==n&&void 0!==n.data("is_template")?"section":"";t.preventDefault(),i(),F.allowHistorySaving("added","specialty_section"),this.collection.add([{type:"section",module_type:"section",mhc_fullwidth:"off",mhc_specialty:"on",cid:o,template_type:s,view:this,created:"auto",admin_label:mhc_options.noun.section}])},addSavedSection:function(t){var o={attributes:{"data-open_view":"saved_templates","data-parent_cid":this.model.get("cid")},view:this},n=new MH_PageComposer.ModalView(o);i(),e("body").append(n.render().el),x("include_shared","","section",e(".mhc-saved-modules-tab"),"regular",0,"all"),t.preventDefault()},expandSection:function(e){e.preventDefault();this.$el.closest(".mhc_section").removeClass("mhc_collapsed"),this.options.model.attributes.mhc_collapsed="off",F.allowHistorySaving("expanded","section"),F.saveAsShortcode()},unlockSection:function(e){e.preventDefault();var t,i=this,o=i.$el.closest(".mhc_section");I().done(function(e){!0===e?(o.removeClass("mhc_locked"),i.options.model.attributes.mhc_locked="off",t=z.getChildrenViews(i.model.get("cid")),_.each(t,function(e,t){e.$el.removeClass("mhc_parent_locked"),e.model.set("mhc_parent_locked","off",{silent:!0})}),F.allowHistorySaving("unlocked","section"),F.saveAsShortcode()):alert(mhc_options.locked_section_permission_alert)})},addRow:function(e){var t=z.generateNewId(),i=void 0!==this.model.get("mhc_shared_module")&&""!==this.model.get("mhc_shared_module")?this.model.get("mhc_shared_module"):"",o=""!==i?this.model.get("cid"):"";this.collection.add([{type:"row",module_type:"row",cid:t,parent:this.model.get("cid"),view:this,appendAfter:e,mhc_shared_parent:i,shared_parent_cid:o,admin_label:mhc_options.noun.row}]),z.getView(t).displayColumnsOptions()},cloneSection:function(e){if(e.preventDefault(),!this.isSectionLocked()){this.$el.clone();var t,i={model:this.model,view:this.$el,view_event:e};t=new MH_PageComposer.RightClickOptionsView(i,!0),F.allowHistorySaving("cloned","section"),t.copy(e),t.pasteAfter(e)}},makeRowsSortable:function(){var t=this,o="on"!==t.model.get("mhc_fullwidth")?".mhc-section-content":".mhc_fullwidth_sortable_area",n=":not(.mhc_locked) > "+o;"on"!==t.model.get("mhc_specialty")&&t.$el.find(o).sortable({connectWith:n,delay:100,cancel:".mhc-settings, .mhc-clone, .mhc-remove, .mhc-row-add, .mhc-insert-module, .mhc-insert-column, .mhc_locked, .mhc-disable-sort",update:function(i,o){if(!e(o.item).closest(i.target).length)return e(i.target).find(".mhc_row").length||(e(this).sortable("cancel"),alert(mhc_options.section_only_row_dragged_away)),void(e(o.item).closest(".mhc-disable-sort").length&&e(i.target).sortable("cancel"));if(e(o.item).closest(".mhc_section.mhc_shared").length&&e(o.item).hasClass("mhc_shared"))e(o.sender).sortable("cancel"),alert(mhc_options.shared_row_alert);else if((e(o.item).closest(".mhc_section.mhc_shared").length||e(o.sender).closest(".mhc_section.mhc_shared").length)&&""===mhc_options.template_post_id){var n,s,a,l=o.item.data("cid");if(s=e(o.sender).closest(".mhc_section.mhc_shared"),a=e(o.item).closest(".mhc_section.mhc_shared"),s===a)R(n=t.collection.find(function(e){return e.get("cid")==l}).get("shared_parent_cid")),M();else for(var d=s,c=1;c<=2;c++)void 0!==(n=d.find(".mhc-section-content").data("cid"))&&""!==n&&(R(n),M()),d=a}z.setNewParentID(o.item.find(".mhc-row-content").data("cid"),t.model.attributes.cid),F.allowHistorySaving("moved","row"),E.trigger("mh-sortable:update");var r=parseInt(e(this).attr("data-cid")),h=0;e(this).find(".mhc-row-content").each(function(){h++;var t=parseInt(e(this).data("cid")),i=r+h;j.findWhere({cid:t}).set({layout_index:i})}),j.comparator="layout_index",j.sort()},start:function(e,t){i()}})},addChildView:function(e){this.child_views.push(e)},removeChildViews:function(){var e=z.getChildViews(this.model.attributes.cid);_.each(e,function(e){void 0!==e.model&&e.model.destroy(),e.remove()})},removeSection:function(e,t){var i,o=!1;e&&e.preventDefault(),this.isSectionLocked()||z.isChildrenLocked(this.model.get("cid"))||("on"===this.model.get("mhc_fullwidth")?this.removeChildViews():(i=z.getChildViews(this.model.get("cid")),_.each(i,function(e){"column"===e.model.get("type")?e.removeColumn():e.removeRow(!1,!0)})),z.get("forceRemove")||"on"!==this.model.get("mhc_specialty")&&"on"!==this.model.get("mhc_fullwidth")||1!==z.getNumberOfModules("section")||(o=!0),(z.get("forceRemove")||o||z.getNumberOfModules("section")>1)&&(this.model.destroy(),z.removeView(this.model.get("cid")),this.remove()),o?F.removeAllSections(!0):(_.isUndefined(t)?F.allowHistorySaving("removed","section"):F.allowHistorySaving("cleared","layout"),e&&E.trigger("mh-module:removed")))},isSectionLocked:function(){return"on"===this.model.get("mhc_locked")},showRightClickOptions:function(e){e.preventDefault();var t={model:this.model,view:this.$el,view_event:e};new MH_PageComposer.RightClickOptionsView(t)},hideRightClickOptions:function(e){e.preventDefault(),i()},renameModule:function(){this.$(".mhc-section-title").html(this.model.get("admin_label"))},toggleDisabledClass:function(){void 0!==this.model.get("mhc_disabled")&&"on"===this.model.get("mhc_disabled")?this.$el.addClass("mhc_disabled"):this.$el.removeClass("mhc_disabled")}}),MH_PageComposer.RowView=window.wp.Backbone.View.extend({className:"mhc_row",template:_.template(e("#mh-composer-row-template").html()),events:{"click .mhc-settings-row":"showSettings","click .mhc-insert-column":"displayColumnsOptions","click .mhc-clone-row":"cloneRow","click .mhc-row-add":"addNewRow","click .mhc-remove-row":"removeRow","click .mhc-change-structure":"changeStructure","click .mhc-expand":"expandRow","contextmenu .mhc-row-add":"showRightClickOptions","click.mhc_row > .mhc-controls .mhc-unlock":"unlockRow","contextmenu.mhc_row > .mhc-controls":"showRightClickOptions","contextmenu.mhc_row > .mhc-right-click-trigger-overlay":"showRightClickOptions","contextmenu .mhc-column":"showRightClickOptions","click.mhc_row > .mhc-controls":"hideRightClickOptions","click.mhc_row > .mhc-right-click-trigger-overlay":"hideRightClickOptions","click > .mhc-locked-overlay":"showRightClickOptions","contextmenu > .mhc-locked-overlay":"showRightClickOptions"},initialize:function(){this.listenTo(E,"mh-add:columns",this.toggleInsertColumnButton),this.listenTo(this.model,"change:admin_label",this.renameModule),this.listenTo(this.model,"change:mhc_disabled",this.toggleDisabledClass)},render:function(){var e=z.getParentViews(this.model.get("parent"));return void 0!==this.model.get("view")&&void 0!==this.model.get("view").model.get("layout_specialty")&&this.model.set("specialty_row","1",{silent:!0}),this.$el.html(this.template(this.model.toJSON())),(void 0!==this.model.get("mhc_shared_module")||void 0!==this.model.get("mhc_template_type")&&"row"===this.model.get("mhc_template_type")&&"shared"===mhc_options.is_shared_template)&&this.$el.addClass("mhc_shared"),void 0!==this.model.get("mhc_disabled")&&"on"===this.model.get("mhc_disabled")&&this.$el.addClass("mhc_disabled"),void 0!==this.model.get("mhc_locked")&&"on"===this.model.get("mhc_locked")&&(this.$el.addClass("mhc_locked"),_.each(e,function(e){e.$el.addClass("mhc_children_locked")})),void 0!==this.model.get("mhc_parent_locked")&&"on"===this.model.get("mhc_parent_locked")&&this.$el.addClass("mhc_parent_locked"),void 0!==this.model.get("mhc_collapsed")&&"on"===this.model.get("mhc_collapsed")&&this.$el.addClass("mhc_collapsed"),void 0!==this.model.get("pasted_module")&&this.model.get("pasted_module")&&c(this.$el),z.is_temp_shared(this.model)&&this.$el.addClass("mhc_shared_temp"),this},showSettings:function(t){var i,o=this,n={model:this.model,collection:this.collection,attributes:{"data-open_view":"module_settings"},triggered_by_right_click:this.triggered_by_right_click,do_preview:this.do_preview};if(void 0!==t&&t.preventDefault(),!this.isRowLocked()){if(i=new MH_PageComposer.ModalView(n),mh_modal_view_rendered=i.render(),!1===mh_modal_view_rendered)return setTimeout(function(){o.showSettings()},500),void E.trigger("mhc-loading:started");if(E.trigger("mhc-loading:ended"),e("body").append(mh_modal_view_rendered.el),void 0!==i.model.get("mhc_shared_module")&&""!==i.model.get("mhc_shared_module")||z.getView(i.model.get("cid")).$el.closest(".mhc_shared").length||void 0!==this.model.get("mhc_template_type")&&"row"===this.model.get("mhc_template_type")&&"shared"===mhc_options.is_shared_template){e(".mhc_modal_settings_container").addClass("mhc_saved_shared_modal");_.each(["general","advanced","custom_css"],function(t){e(".mhc_options_tab_"+t).addClass("mhc_saved_shared_tab")})}}},displayColumnsOptions:function(t){if(t&&t.preventDefault(),!this.isRowLocked()){var i;this.model.set("open_view","column_settings",{silent:!0}),i=new MH_PageComposer.ModalView({model:this.model,collection:this.collection,attributes:{"data-open_view":"column_settings"},view:this}),e("body").append(i.render().el),this.toggleInsertColumnButton()}},changeStructure:function(t){t.preventDefault();var i;this.isRowLocked()||(this.model.set("change_structure","true",{silent:!0}),this.model.set("open_view","column_settings",{silent:!0}),MH_PageComposer.Events=E,i=new MH_PageComposer.ModalView({model:this.model,collection:this.collection,attributes:{"data-open_view":"column_settings"},view:this}),e("body").append(i.render().el))},expandRow:function(e){e.preventDefault();this.$el.closest(".mhc_row").removeClass("mhc_collapsed"),this.options.model.attributes.mhc_collapsed="off",F.allowHistorySaving("expanded","row"),F.saveAsShortcode()},unlockRow:function(e){e.preventDefault();var t,i,o=this,n=o.$el.closest(".mhc_row");I().done(function(e){!0===e?(n.removeClass("mhc_locked"),o.options.model.attributes.mhc_locked="off",t=z.getChildrenViews(o.model.get("cid")),_.each(t,function(e,t){e.$el.removeClass("mhc_parent_locked"),e.model.set("mhc_parent_locked","off",{silent:!0})}),i=z.getParentViews(o.model.get("parent")),_.each(i,function(e,t){z.isChildrenLocked(e.model.get("cid"))||e.$el.removeClass("mhc_children_locked")}),F.allowHistorySaving("unlocked","row"),F.saveAsShortcode()):alert(mhc_options.locked_row_permission_alert)})},toggleInsertColumnButton:function(){var e,t=this.model.get("cid");e=this.collection.find(function(e){return("column"===e.get("type")||"column_inner"===e.get("type"))&&e.get("parent")===t}),_.isUndefined(e)||(this.$(".mhc-insert-column").hide(),this.$(".mhc-change-structure").show())},addNewRow:function(t){var o=this.$el.closest(".mhc-section-content"),n=e(t.currentTarget),s=n.closest(".mhc-column-specialty").length?n.closest(".mhc-column-specialty").data("cid"):o.data("cid"),a=z.getView(s);t.preventDefault(),i(),"on"!==this.model.get("mhc_parent_locked")&&(F.allowHistorySaving("added","row"),a.addRow(this.$el))},cloneRow:function(e){var t,i="",o=z.getView(this.model.get("parent")),n={model:this.model,view:this.$el,view_event:e};e.preventDefault(),this.isRowLocked()||(this.$el.closest(".mhc_section.mhc_shared").length&&void 0===o.model.get("mhc_template_type")&&(i=this.model.get("shared_parent_cid")),t=new MH_PageComposer.RightClickOptionsView(n,!0),F.allowHistorySaving("cloned","row"),t.copy(e),t.pasteAfter(e),""!==i&&R(i))},removeRow:function(e,t){var i,o="",n=z.getView(this.model.get("parent"));this.isRowLocked()||z.isChildrenLocked(this.model.get("cid"))||(e&&(e.preventDefault(),this.$el.closest(".mhc-column-specialty").length&&e.stopPropagation(),this.$el.closest(".mhc_section.mhc_shared").length&&void 0===n.model.get("mhc_template_type")&&(o=this.model.get("shared_parent_cid"))),i=z.getChildViews(this.model.get("cid")),_.each(i,function(e){e.removeColumn()}),z.get("forceRemove")||z.getNumberOf("row",this.model.get("parent"))>1?(this.model.destroy(),z.removeView(this.model.get("cid")),this.remove()):(this.$(".mhc-insert-column").show(),this.$(".mhc-change-structure").hide()),F.allowHistorySaving("removed","row"),e&&E.trigger("mh-module:removed"),""!==o&&R(o))},isRowLocked:function(){return"on"===this.model.get("mhc_locked")||"on"===this.model.get("mhc_parent_locked")},showRightClickOptions:function(t){t.preventDefault();var i,o=e(t.target);o.closest(".mhc-insert-module").length||o.hasClass("mhc_module_block")||o.closest(".mhc_module_block").length||(i={model:this.model,view:this.$el,view_event:t},new MH_PageComposer.RightClickOptionsView(i))},hideRightClickOptions:function(e){e.preventDefault(),i()},renameModule:function(){this.$(".mhc-row-title").html(this.model.get("admin_label"))},toggleDisabledClass:function(){void 0!==this.model.get("mhc_disabled")&&"on"===this.model.get("mhc_disabled")?this.$el.addClass("mhc_disabled"):this.$el.removeClass("mhc_disabled")}}),MH_PageComposer.ModalView=window.wp.Backbone.View.extend({className:"mhc_modal_settings_container",template:_.template(e("#mh-composer-modal-template").html()),events:{"click .mhc-modal-save":"saveSettings","click .mhc-modal-preview-template":"preview","click .mhc-preview-mobile":"resizePreviewScreen","click .mhc-preview-tablet":"resizePreviewScreen","click .mhc-preview-desktop":"resizePreviewScreen","click .mhc-modal-close":"closeModal","click .mhc-modal-save-template":"saveTemplate","change #mhc_select_category":"applyFilter"},initialize:function(e){this.listenTo(E,"mh-add:columns",this.removeView),this.listenTo(E,"mh-new_module:show_settings",this.removeView),this.listenTo(E,"mh-saved_layout:loaded",this.removeView),this.options=e},render:function(){var t,i={model:this.model,collection:this.collection,view:this.options.view},o=!1;if(this.$el.attr("tabindex",0),void 0===this.model||void 0===this.model.get("view")||"row_inner"!==this.model.get("module_type")&&"row"!==this.model.get("module_type")||this.model.get("parent")===this.model.get("view").$el.data("cid")||this.model.set("view",z.getView(this.model.get("parent")),{silent:!0}),"all_modules"===this.attributes["data-open_view"]&&"section"===this.model.get("module_type")&&"on"===this.model.get("mhc_fullwidth")&&(this.model.set("type","column",{silent:!0}),o=!0),void 0!==this.model){var n=z.getView(this.model.get("parent")),s=void 0!==this.model.get("mhc_template_type")&&"module"===this.model.get("mhc_template_type")||void 0!==this.model.get("template_type")&&"module"===this.model.get("template_type"),a=void 0!==this.model.get("mhc_saved_tabs")&&"all"!==this.model.get("mhc_saved_tabs")||void 0!==n&&void 0!==n.model.get("mhc_saved_tabs")&&"all"!==n.model.get("mhc_saved_tabs");if("column_specialty_settings"===this.attributes["data-open_view"]&&this.model.set("open_view","column_specialty_settings",{silent:!0}),this.$el.html(this.template(this.model.toJSON())),"column_specialty_settings"===this.attributes["data-open_view"]&&this.model.unset("open_view","column_specialty_settings",{silent:!0}),s&&a){var l=void 0!==this.model.get("mhc_saved_tabs")?this.model.get("mhc_saved_tabs"):n.model.get("mhc_saved_tabs"),d=l.split(","),c="",r="";"all"!==d[0]&&(_.each(["general","advanced","css"],function(t){-1===e.inArray(t,d)?c+=" mhc_hide_"+t+"_tab":r=""===r?t:r}),r="css"===r?"custom_css":r),this.$el.addClass(c),void 0===this.model.get("mhc_saved_tabs")&&this.model.set("mhc_saved_tabs",l,{silent:!0})}}else this.$el.html(this.template());return o&&this.model.set("type","section",{silent:!0}),this.container=this.$(".mhc-modal-container"),"column_settings"===this.attributes["data-open_view"]?t=new MH_PageComposer.ColumnSettingsView(i):"all_modules"===this.attributes["data-open_view"]?(i.attributes={"data-parent_cid":this.model.get("cid")},t=new MH_PageComposer.ModulesView(i)):"module_settings"===this.attributes["data-open_view"]?(i.attributes={"data-module_type":this.model.get("module_type")},i.view=this,t=new MH_PageComposer.ModuleSettingsView(i)):"save_layout"===this.attributes["data-open_view"]?t=new MH_PageComposer.SaveLayoutSettingsView(i):"column_specialty_settings"===this.attributes["data-open_view"]?t=new MH_PageComposer.ColumnSettingsView(i):"saved_templates"===this.attributes["data-open_view"]&&(t=new MH_PageComposer.TemplatesModal({attributes:{"data-parent_cid":this.attributes["data-parent_cid"]}})),(void 0===t.attributes||"no_template"!==t.attributes["data-no_template"])&&(this.container.append(t.render().el),"column_settings"===this.attributes["data-open_view"]&&this.model.unset("open_view",{silent:!0}),"all_modules"===this.attributes["data-open_view"]&&("section"!==this.model.get("module_type")||(this.model.get("mhc_fullwidth"),0)||"on"!==this.model.get("mhc_fullwidth")?e(t.render().el).find("li.mhc_fullwidth_only_module").remove():e(t.render().el).find(".mhc-all-modules li:not(.mhc_fullwidth_only_module)").remove()),e(".mhc_modal_overlay").length&&(e(".mhc_modal_overlay").remove(),e("body").removeClass("mhc_stop_scroll")),e("body").hasClass("mhc_modal_fade_in")?e("body").append('<div class="mhc_modal_overlay mhc_no_animation"></div>'):e("body").append('<div class="mhc_modal_overlay"></div>'),e("body").addClass("mhc_stop_scroll"),this)},closeModal:function(t){t.preventDefault(),e(".mh_modal_on_top").length?e(".mh_modal_on_top").remove():(void 0!==this.model&&"module"===this.model.get("type")&&this.$("#mhc_content_new").length&&f("mhc_content_new"),S(this),h(this,"trigger_event"))},removeView:function(){if(void 0===this.model||"row"===this.model.get("type")||"column"===this.model.get("type")||"row_inner"===this.model.get("type")||"column_inner"===this.model.get("type")||"section"===this.model.get("type")&&("on"===this.model.get("mhc_fullwidth")||"on"===this.model.get("mhc_specialty")))if(void 0!==this.model&&void 0!==this.model.get("type")&&("column"===this.model.get("type")||"column_inner"===this.model.get("type")||"section"===this.model.get("type")&&"on"===this.model.get("mhc_fullwidth"))){e(this.el).find(".mhc-main-settings.active-container").hasClass("mhc-saved-modules-tab")?h(this):(this.remove(),e("body").addClass("mhc_modal_fade_in"),e(".mhc_modal_overlay").addClass("mhc_no_animation"),setTimeout(function(){e(".mhc_modal_settings_container").addClass("mhc_no_animation"),e("body").removeClass("mhc_modal_fade_in")},500))}else h(this);else this.removeOverlay()},saveSettings:function(t,i){var o=this,n="",s=z.getView(o.model.get("cid")),a=void 0!==o.model.get("parent")?z.getView(o.model.get("parent")):"",l=""===a||void 0!==o.model.get("mhc_shared_module")&&""!==o.model.get("mhc_shared_module")?s:a,d=!1,i=!!_.isUndefined(i)||i;if(t.preventDefault(),e("#publish").addClass("disabled"),F.disable_publish=!0,(void 0!==l.model.get("shared_parent_cid")&&""!==l.model.get("shared_parent_cid")||void 0!==l.model.get("mhc_shared_module")&&""!==l.model.get("mhc_shared_module"))&&(n=void 0!==l.model.get("shared_parent_cid")?l.model.get("shared_parent_cid"):l.model.get("cid")),(void 0!==o.model.get("mhc_template_type")&&"module"===o.model.get("mhc_template_type")||""!==n)&&void 0!==o.model.get("mhc_saved_tabs")||""!==a&&void 0!==a.model.get("mhc_saved_tabs")){var c=void 0===o.model.get("mhc_saved_tabs")?a.model.get("mhc_saved_tabs").split(","):o.model.get("mhc_saved_tabs").split(","),r="",m=o.model.attributes;_.each(c,function(e){switch(e){case"general":r+=""!==r?",":"",r+=".mhc-options-tab-general input, .mhc-options-tab-general select, .mhc-options-tab-general textarea";break;case"advanced":r+=""!==r?",":"",r+=".mhc-options-tab-advanced input, .mhc-options-tab-advanced select, .mhc-options-tab-advanced textarea";break;case"css":r+=""!==r?",":"",r+=".mhc-options-tab-custom_css input, .mhc-options-tab-custom_css select, .mhc-options-tab-custom_css textarea"}}),_.each(m,function(e,t){-1!==t.indexOf("mhc_")&&"mhc_template_type"!==t&&"mhc_saved_tabs"!==t&&"mhc_shared_module"!==t&&o.model.unset(t,{silent:!0})}),void 0===o.model.get("mhc_saved_tabs")&&o.model.set("mhc_saved_tabs",a.model.get("mhc_saved_tabs")),void 0!==o.model.get("mhc_template_type")&&"module"===o.model.get("mhc_template_type")&&(d=!0)}o.performSaving(r),""!==n&&R(n),!1===d&&void 0!==r&&o.performSaving(),F.allowHistorySaving("edited",o.model.get("type"),o.model.get("admin_label")),i&&(f("mhc_content_new"),S(o),h(o,"trigger_event"))},preview:function(t){var i,o,n,s=this.model.get("cid"),a=e(t.target).is("a")?e(t.target):e(t.target).parent("a"),l=e(t.target).parents(".mhc-modal-container"),d=document.documentMode;if(t.preventDefault(),_.isUndefined(this.options.triggered_by_right_click)?this.saveSettings(t,!1):delete this.options.triggered_by_right_click,_.isUndefined(this.options.do_preview)||delete this.options.do_preview,"1"===mhc_options.is_mharty_vault&&e.inArray(mhc_options.layout_type,["row","module"])>-1?s=void 0:"section"!==this.model.get("type")&&(n=z.getSectionView(this.model.get("parent")),_.isUndefined(n)||(s=n.model.attributes.cid)),i=F.generateCompleteShortcode(s),o={mhc_preview_nonce:mhc_options.mhc_preview_nonce,shortcode:i,post_title:e("#title").val()},a.toggleClass("active"),l.toggleClass("mhc-item-previewing"),e(".mhc_modal_settings_container").toggleClass("mhc-window-previewing"),a.hasClass("active")){var c=e("<iframe />",{id:"mhc-preview-screen",src:mhc_options.preview_url+"&mhc_preview_nonce="+mhc_options.mhc_preview_nonce}),r=!1;e(".mhc-preview-tab").html(c),e("#mhc-preview-screen").load(function(){r||(preview=document.getElementById("mhc-preview-screen"),!_.isUndefined(d)&&d<10&&(o=JSON.stringify(o)),preview.contentWindow.postMessage(o,mhc_options.preview_url),r=!0)})}else e(".mhc-preview-tab").empty(),e(".mhc-preview-screensize-switcher a").removeClass("active"),e(".mhc-preview-desktop").addClass("active")},resizePreviewScreen:function(t){t.preventDefault();var i=e(t.target),o=_.isUndefined(i.data("width"))?"100%":i.data("width");e(".mhc-preview-screensize-switcher a").removeClass("active"),i.addClass("active"),e("#mhc-preview-screen").animate({width:o})},performSaving:function(t){var i,o={},n={},s=void 0!==t&&""!==t?t:"input, select, textarea, #mhc_content_main";if((i=e(this)[0].$el.find("form.validate")).length){if(validator=i.validate(),!validator.form())return $("failed form validation"),$("failed elements: "),$(validator.errorList),void validator.focusInvalid();$("passed form validation")}MH_PageComposer.Events.trigger("mh-modal-settings:save",this),this.$(s).each(function(){var t,i,s=e(this),a=[],l=s.is("#mhc_content_main")?"mhc_content_new":s.attr("id"),d=s.data("default")||"";if(d+="",s.is(":checkbox")&&(l=s.attr("name")),void 0===l||-1!==l.indexOf("qt_")&&"button"===s.attr("type"))return!0;if(s.hasClass("mhc-helper-field"))return!0;if(s.is(":checkbox")&&void 0!==o[l])return!0;if(s.hasClass("mhc-color-picker-hex")&&new Color(s.val()).error&&s.val(s.data("selected-value")),s.is(":checkbox")&&void 0===o[l])s.closest(".mhc-option-container").find('[name="'+l+'"]:checked').each(function(){a.push(e(this).val())}),t=a.join(",");else if(s.is("#mhc_content_main"))t=(t=s.html()).replace(/\^\^/g,"%22");else if(s.closest(".mhc-custom-css-option").length)t=""!==(i=s.val())?i.replace(/\n/g,"||"):"";else if(s.hasClass("mhc-range-input")||s.hasClass("mhc-validate-unit")){var c=s.hasClass("mhc-range-input")?"no_default_unit":"";t=C(s.val(),!1,c)}else s.is(":checkbox")||(t=s.is("textarea#mhc_content_new")?p("mhc_content_new"):s.val(),s.hasClass("mhc-range-input")&&"px"===t&&(t=""));""!==d&&(n[l]=d),o[l]=t}),o.module_defaults=n,this.model.set(o)},saveTemplate:function(e){var t=-1!==this.model.get("module_type").indexOf("fullwidth")?"fullwidth":"regular",i=void 0!==this.model.get("columns_layout")?this.model.get("columns_layout"):"0";e.preventDefault(),d("save_template",this,t,i)},removeOverlay:function(){var t=e(".mhc_modal_overlay");if(t.length&&(t.addClass("mhc_overlay_closing"),setTimeout(function(){t.remove(),e("body").removeClass("mhc_stop_scroll")},600)),!_.isUndefined(F.disable_publish))setTimeout(function(){_.isUndefined(F.disable_publish)||(e("#publish").removeClass("disabled"),delete F.disable_publish)},3e3)},applyFilter:function(){var t=e(event.target),i=t.data("attr"),o=t.val();i.append_to.html(""),x(i.include_shared,"",i.layout_type,i.append_to,i.module_width,i.specialty_cols,o)}}),MH_PageComposer.ColumnView=window.wp.Backbone.View.extend({template:_.template(e("#mh-composer-column-template").html()),events:{"click .mhc-insert-module":"addModule","contextmenu > .mhc-insert-module":"showRightClickOptions",click:"hideRightClickOptions"},initialize:function(){this.$el.attr("data-cid",this.model.get("cid"))},render:function(){var t=this,o="section"===this.model.get("module_type")&&"on"===this.model.get("mhc_fullwidth"),n=o?".mhc_fullwidth_sortable_area":".mhc-column:not(.mhc-column-specialty, .mhc_parent_locked)";return this.$el.html(this.template(this.model.toJSON())),o&&this.$el.addClass("mhc_fullwidth_sortable_area"),"1"===this.model.get("layout_specialty")&&(n=".mhc-column-specialty:not(.mhc_parent_locked)"),"manually"!==this.model.get("created")||_.isUndefined(this.model.get("mhc_specialty_columns"))||this.$el.addClass("mhc-column-specialty"),this.isColumnParentLocked(this.model.get("parent"))&&(this.$el.addClass("mhc_parent_locked"),this.model.set("mhc_parent_locked","on",{silent:!0})),this.$el.sortable({cancel:".mhc-settings, .mhc-clone, .mhc-remove, .mhc-insert-module, .mhc-insert-column, .mhc_locked, .mhc-disable-sort",connectWith:n,delay:100,items:"1"!==this.model.get("layout_specialty")?".mhc_module_block":".mhc_row",receive:function(i,o){var n=e(this),s=!1;if(n.hasClass("mhc-column-specialty")&&(!e(o.sender).find(".mhc_row").length||e(o.item).is(".mhc_module_block")?(alert(mhc_options.section_only_row_dragged_away),s=!0):3===e(o.item).find(".mhc-row-container > .mhc-column").length&&3!==parseInt(z.getView(n.data("cid")).model.get("specialty_columns"))&&(alert(mhc_options.stop_dropping_3_col_row),s=!0)),e(o.item).closest(".mhc-disable-sort").length&&(s=!0),(e(o.item).closest(".mhc_section.mhc_shared").length||e(o.item).closest(".mhc_row.mhc_shared").length)&&e(o.item).hasClass("mhc_shared"))alert(mhc_options.shared_module_alert),s=!0;else if((e(o.item).closest(".mhc_section.mhc_shared").length||e(o.item).closest(".mhc_row.mhc_shared").length||e(o.sender).closest(".mhc_row.mhc_shared").length||e(o.sender).closest(".mhc_section.mhc_shared").length)&&""===mhc_options.template_post_id){var a,l,d,c=o.item.data("cid");if(l=e(o.sender).closest(".mhc_row.mhc_shared").length?e(o.sender).closest(".mhc_row.mhc_shared"):e(o.sender).closest(".mhc_section.mhc_shared"),d=e(o.item).closest(".mhc_row.mhc_shared").length?e(o.item).closest(".mhc_row.mhc_shared"):e(o.item).closest(".mhc_section.mhc_shared"),l===d)R(a=t.collection.find(function(e){return e.get("cid")==c}).get("shared_parent_cid")),M();else for(var r=l,h=1;h<=2;h++)void 0!==(a=void 0!==r.find(".mhc-section-content").data("cid")?r.find(".mhc-section-content").data("cid"):r.find(".mhc-row-content").data("cid"))&&""!==a&&(R(a),M()),r=d}s&&(e(o.sender).sortable("cancel"),M())},update:function(i,o){var n,s,a=o.item.data("cid");s=e(o.item),void 0===a&&e(i.target).is(".mhc-column-specialty")&&(s=e(o.item).closest(".mhc_row").find(".mhc-row-content"),a=s.data("cid")),!e(i.target).is(".mhc-column-specialty")&&e(o.item).closest(i.target).length&&1===e(i.target).find(".mhc_module_block").length&&(e(i.target).find(".mhc-insert-module").length?s.insertBefore(e(i.target).find(".mhc-insert-module")):e(i.target).append(s)),n=t.collection.find(function(e){return e.get("cid")==a}),F.allowHistorySaving("moved","module",n.get("admin_label")),n.get("parent")===t.model.attributes.cid&&e(o.item).closest(i.target).length?E.trigger("mh-model-changed-position-within-column"):n.set("parent",t.model.attributes.cid);var l=parseInt(e(this).attr("data-cid")),d=0;e(this).find(".mhc_module_block").each(function(){d++;var t=parseInt(e(this).data("cid")),i=l+d;j.findWhere({cid:t}).set({layout_index:i})}),j.comparator="layout_index",j.sort()},start:function(e,t){i()}}),this},addModule:function(t){var o=e(t.target),n=o.is("span")?o.parent(".mhc-insert-module"):o;if(t.preventDefault(),t.stopPropagation(),!this.isColumnLocked()&&n.parent().is(t.delegateTarget)){i();var s;s=new MH_PageComposer.ModalView({model:this.model,collection:this.collection,attributes:{"data-open_view":"all_modules"},view:this}),e("body").append(s.render().el)}},addRow:function(e){var t=z.generateNewId(),i=void 0!==this.model.get("mhc_shared_parent")&&""!==this.model.get("mhc_shared_parent")?this.model.get("mhc_shared_parent"):"",o=""!==i?this.model.get("shared_parent_cid"):"";this.isColumnLocked()||(this.collection.add([{type:"row",module_type:"row",cid:t,parent:this.model.get("cid"),view:this,appendAfter:e,mhc_shared_parent:i,shared_parent_cid:o,admin_label:mhc_options.noun.row}]),z.getView(t).displayColumnsOptions())},removeColumn:function(){var e;e=z.getChildViews(this.model.get("cid")),_.each(e,function(e){"row"===e.model.get("type")||"row_inner"===e.model.get("type")?e.removeRow():e.removeModule()}),z.removeView(this.model.get("cid")),this.model.destroy(),this.remove()},isColumnLocked:function(){return"on"===this.model.get("mhc_locked")||"on"===this.model.get("mhc_parent_locked")},isColumnParentLocked:function(e){var t=z.getView(e);return!(_.isUndefined(t)||"on"!==t.model.get("mhc_locked")&&"on"!==t.model.get("mhc_parent_locked"))},showRightClickOptions:function(e){e.preventDefault();var t={model:this.model,view:this.$el,view_event:e};t.model.attributes.is_insert_module=!0,new MH_PageComposer.RightClickOptionsView(t)},hideRightClickOptions:function(e){e.preventDefault(),i()}}),MH_PageComposer.ColumnSettingsView=window.wp.Backbone.View.extend({className:"mhc_modal_settings",template:_.template(e("#mh-composer-column-settings-template").html()),events:{"click .mhc-column-layouts li":"addColumns","click .mhc-options-tabs-links li a":"switchTab"},initialize:function(e){this.listenTo(E,"mh-add:columns",this.removeView),this.listenTo(E,"mh-modal-view-removed",this.removeViewAndEmptySection),this.options=e},render:function(){return this.$el.html(this.template(this.model.toJSON())),z.getView(this.model.get("cid")).$el.closest(".mhc_shared").length&&this.$el.addClass("mhc_no_shared"),(void 0!==this.model.get("mhc_specialty")&&"on"===this.model.get("mhc_specialty")||void 0!==this.model.get("change_structure")&&"true"===this.model.get("change_structure"))&&this.$el.addClass("mhc_modal_no_tabs"),this},addColumns:function(t){t.preventDefault();var i=this,o=e(t.target).is("li")?e(t.target):e(t.target).closest("li"),n=o.data("layout").split(","),s="section"===i.model.get("type")&&"on"===i.model.get("mhc_specialty")?o.data("specialty").split(","):"",a=_.size(n),l=this.options.view;if(void 0!==i.model.get("change_structure")&&"true"===i.model.get("change_structure")){var d=z.getChildViews(i.model.get("cid")),c=[],r=0,h=void 0!==i.model.get("shared_parent_cid")?i.model.get("shared_parent_cid"):"";_.each(d,function(e){c[r]=e.model.get("cid"),r+=1})}if(_.each(n,function(e,t){var n=a==t+1?"true":"false",d={type:"column",cid:z.generateNewId(),parent:i.model.get("cid"),layout:e,view:l};void 0!==i.model.get("mhc_shared_parent")&&""!==i.model.get("mhc_shared_parent")&&(d.mhc_shared_parent=i.model.get("mhc_shared_parent"),d.shared_parent_cid=i.model.get("shared_parent_cid")),""!==s&&(d.layout_specialty=s[t],d.specialty_columns=parseInt(o.data("specialty_columns"))),void 0!==i.model.get("specialty_row")&&(i.model.set("module_type","row_inner",{silent:!0}),i.model.set("type","row_inner",{silent:!0})),i.collection.add([d],{update_shortcodes:n})}),void 0!==i.model.get("change_structure")&&"true"===i.model.get("change_structure")){var m=[];for(d=z.getChildViews(i.model.get("cid")),r=0,_.each(d,function(e){m[r]=e.model.get("cid"),r+=1}),m.splice(0,c.length),index=0;index<c.length;index++){var p,u=c.length>m.length&&index>m.length-1,g=c[index],v=u?m[m.length-1]:m[index],f=z.getView(g).$el.html(),w=z.getChildViews(g),y="";z.getView(g).model.destroy(),z.getView(g).remove(),z.removeView(g),p=e('.mhc-column[data-cid="'+v+'"]'),u?(p.find(".mhc-insert-module").remove(),y=p.html(),p.html(y+f)):p.html(f),_.each(w,function(e){e.model.set("parent",v,{silent:!0})})}F.allowHistorySaving("edited","column"),M()}void 0!==i.model.get("template_type")&&"section"===i.model.get("template_type")&&"on"===i.model.get("mhc_specialty")&&M(),void 0!==i.model.get("mhc_template_type")&&"row"===i.model.get("mhc_template_type")&&A("_mhc_row_layout",o.data("layout")),void 0!==h&&""!==h&&R(h),F.allowHistorySaving("added","column"),E.trigger("mh-add:columns")},removeView:function(){var e=this;setTimeout(function(){e.remove()},300)},switchTab:function(t){var i=e(t.currentTarget).parent();t.preventDefault(),T(i,"row","")},removeViewAndEmptySection:function(){"on"===this.model.get("mhc_specialty")&&(this.options.view.model.destroy(),z.removeView(this.options.view.model.get("cid")),this.options.view.remove()),this.remove()}}),MH_PageComposer.SaveLayoutSettingsView=window.wp.Backbone.View.extend({className:"mhc_modal_settings",template:_.template(e("#mh-composer-load_layout-template").html()),events:{"click .mhc_layout_button_load":"loadLayout","click .mhc_layout_button_delete":"deleteLayout","click .mhc-options-tabs-links li a":"switchTab"},initialize:function(e){this.options=e,this.layoutIsLoading=!1,this.listenTo(E,"mh-modal-view-removed",this.remove)},render:function(){var t=this.$el,i=e("#post_type").val();return t.html(this.template({display_switcher:"on"})),O("preset","mhc-all-modules-tab",t,i),O("not_preset","mhc-saved-modules-tab",t,i),this},deleteLayout:function(t){t.preventDefault();var i=e(t.currentTarget).closest("li");i.hasClass("mhc_deleting_layout")||(i.addClass("mhc_deleting_layout"),e.ajax({type:"POST",url:mhc_options.ajaxurl,data:{action:"mhc_delete_layout",mh_admin_load_nonce:mhc_options.mh_admin_load_nonce,mh_layout_id:i.data("layout_id")},beforeSend:function(){E.trigger("mhc-loading:started"),i.css("opacity","0.5")},complete:function(){E.trigger("mhc-loading:ended")},success:function(e){1==i.closest("ul").find("> li").length&&i.closest("ul").prev("h3").hide(),i.remove()}}))},loadLayout:function(t){if(t.preventDefault(),!this.layoutIsLoading){this.layoutIsLoading=!0,this.$el.find(".mhc-main-settings").css({opacity:"0.5"});var i=e(t.currentTarget).closest("li"),o=i.closest(".mhc-main-settings").find("#mhc_load_layout_replace").is(":checked"),n=p("content");e.ajax({type:"POST",url:mhc_options.ajaxurl,data:{action:"mhc_load_layout",mh_admin_load_nonce:mhc_options.mh_admin_load_nonce,mh_layout_id:i.data("layout_id"),mh_replace_content:o?"on":"off"},beforeSend:function(){E.trigger("mhc-loading:started")},complete:function(){E.trigger("mhc-loading:ended"),E.trigger("mh-saved_layout:loaded")},success:function(e){n=o?e:e+n,F.removeAllSections(),""!==n&&F.allowHistorySaving("loaded","layout"),F.createNewLayout(n,"load_layout")}})}},switchTab:function(t){var i=e(t.currentTarget).parent();t.preventDefault(),T(i,"layout","")}}),MH_PageComposer.ModulesView=window.wp.Backbone.View.extend({className:"mhc_modal_settings",template:_.template(e("#mh-composer-modules-template").html()),events:{"click .mhc-all-modules li":"addModule","click .mhc-options-tabs-links li a":"switchTab"},initialize:function(e){this.options=e,this.listenTo(E,"mh-modal-view-removed",this.remove)},render:function(){var e=void 0!==z.getView(this.model.get("parent"))?z.getView(this.model.get("parent")):this;return this.$el.html(this.template(z.toJSON())),(z.getView(this.model.get("cid")).$el.closest(".mhc_shared").length||void 0!==e.model.get("mhc_template_type")&&"module"===e.model.get("mhc_template_type"))&&this.$el.addClass("mhc_no_shared"),this},addModule:function(t){var i=e(t.currentTarget),o=i.find(".mh_module_title").text(),n=i.attr("class").replace(" mhc_fullwidth_only_module",""),s="",a=z.getView(this.model.get("parent")),l=void 0!==a?a:this;t.preventDefault(),void 0!==this.model.get("mhc_shared_parent")&&""!=typeof this.model.get("mhc_shared_parent")&&(s=this.model.get("shared_parent_cid")),F.allowHistorySaving("added","module",o),this.collection.add([{type:"module",cid:z.generateNewId(),module_type:n,admin_label:o,parent:this.attributes["data-parent_cid"],view:this.options.view,shared_parent_cid:s}]),this.remove(),""!==s&&R(s),void 0!==l.model.get("mhc_template_type")&&"module"===l.model.get("mhc_template_type")&&A("_mhc_module_type",n),D()},switchTab:function(t){var i=e(t.currentTarget).parent(),o=(this.model.get("mhc_fullwidth"),"on"===this.model.get("mhc_fullwidth")?"fullwidth":"regular");t.preventDefault(),T(i,"module",o)}}),MH_PageComposer.ModuleSettingsView=window.wp.Backbone.View.extend({className:"mhc_module_settings",initialize:function(){e(z.generateTemplateName(this.attributes["data-module_type"])).length?(this.template=_.template(e(z.generateTemplateName(this.attributes["data-module_type"])).html()),this.listenTo(E,"mh-modal-view-removed",this.removeModule),this.listenTo(E,"mh-advanced-module:saved",this.renderMap)):this.attributes["data-no_template"]="no_template"},events:{},render:function(){var t,i,a,l,d,c,r,h,m,p,g=this.$el,f="",w=this.model.attributes.cid,k=!1,C=["mhc_overlay_icon","mhc_font_mhicons","mhc_font_steadysets","mhc_font_awesome","mhc_font_lineicons","mhc_font_etline","mhc_font_icomoon","mhc_font_linearicons"];if(_.each(this.model.attributes,function(t,i,o){if("string"==typeof t&&"mhc_content_new"!==i&&-1===e.inArray(i,C)&&!/^\%\%\d+\%\%$/.test(e.trim(t)))return o[i]=t.replace(/%22/g,'"')}),this.$el.html(this.template(this.model.attributes)),t=this.$el.find("#mhc_content_new"),d=this.$el.find(".mhc-color-picker-hex"),$color_picker_alpha=this.$el.find(".mh-composer-color-picker-alpha"),c=this.$el.find(".mhc-upload-button"),r=this.$el.find(".mhc-video-image-button"),h=this.$el.find(".mhc-gallery-button"),$time_picker=this.$el.find(".mhc-date-time-picker"),m=this.$el.find(".mhc-icon"),$validation_element=g.find(".mh-validate-number"),(p=g.find("form.validate")).length&&($("validation enabled"),p.validate({debug:!0})),d.length&&(d.wpColorPicker({defaultColor:d.data("default-color"),palettes:mhc_options.default_color_scheme.split("|"),change:function(t,i){var o=e(this),n=o.closest(".mhc-option-container").find(".mhc-reset-setting"),s=o.closest(".mhc-custom-color-container"),a=o.val();s.length&&s.find(".mhc-custom-color-picker").val(i.color.toString()),n.length&&(a!==b(o)?n.addClass("mhc-reset-icon-visible"):n.removeClass("mhc-reset-icon-visible"))},clear:function(){e(this).val(mhc_options.invalid_color),e(this).closest(".mhc-option-container").find(".mhc-main-setting").val("")}}),d.each(function(){var t=e(this),i=t.data("default-color")||"",o=t.closest(".mhc-option-container").find(".mhc-reset-setting");if(!o.length)return!0;i!==t.val()&&o.addClass("mhc-reset-icon-visible")})),$color_picker_alpha.length&&$color_picker_alpha.each(function(){var t=e(this),i=t.data("value").split("|"),o=i[0]||"#444444",n=i[2]||1;t.attr("data-opacity",n),t.val(o),t.minicolors({control:"hue",defaultValue:e(this).data("default-color")||"",opacity:!0,changeDelay:200,show:function(){t.minicolors("opacity",t.data("opacity"))},change:function(i,o){if(i){var n,s=t.minicolors("rgbObject"),a=e(t.data("field")),l=[];l.push(i),l.push(s.r+", "+s.g+", "+s.b),l.push(o),n=l.join("|"),a.length&&a.val(n)}},theme:"bootstrap"})}),c.length&&o(c),r.length&&s(r),h.length&&n(h),$time_picker.length&&$time_picker.datetimepicker(),$validation_element.length&&$validation_element.keyup(function(){var t=e(this);(t.val()<0||!e.isNumeric(t.val())&&""!==t.val())&&t.val(0),t.val()>100&&t.val(100),""!==t.val()&&t.val(Math.round(t.val()))}),m.length){var S=this;m.each(function(){function t(){""!==l&&(-1!==l.search(/^%%/)?(n=parseInt(l.replace(/%/g,"")),i=s.find("li").eq(n)):i=s.find('li[data-icon="'+l+'"]'),i.addClass(c),s.is(":visible")&&setTimeout(function(){(o=i.offset().top-s.offset().top)>0&&s.animate({scrollTop:o},0)},110))}var i,o,n,s=e(this),a=s.siblings(".mhc-font-icon"),l=e.trim(a.val()),d=s.find("li"),c="mh_active";t(),S.$el.find(".mhc-options-tabs-links").on("mhc_main_tab:changed",t),d.click(function(){var t=e(this),i=t.index();if(t.hasClass(c))return!1;t.siblings("."+c).removeClass(c).end().addClass(c),i="%%"+i+"%%",a.val(i)})})}if(t.length)if((a=t.closest(".mhc-option")).hasClass("mhc-option-advanced-module")&&(k=!0),k){var M=z.generateNewId();this.view_cid=M,a.hide(),t.attr("id","mhc_content_main"),l=new MH_PageComposer.AdvancedModuleSettingsView({model:this,el:this.$el.find(".mhc-option-advanced-module-settings"),attributes:{cid:M}}),z.addView(M,l),a.before(l.render()),""!==t.html()&&(l.generateAdvancedSortableItems(t.html(),this.$el.find(".mhc-option-advanced-module-settings").data("module_type")),E.trigger("mh-advanced-module:updated_order",this.$el))}else i=t.closest(".mhc-option-container"),f=t.html(),t.remove(),i.prepend(q),setTimeout(function(){void 0!==window.switchEditors&&window.switchEditors.go("mhc_content_new",u()),v("mhc_content_new",f),window.wpActiveEditor="mhc_content_new"},100);return this.renderMap(),y(this.$el,w),k||setTimeout(function(){g.find("select, input, textarea, radio").filter(":eq(0)").focus()},1),this},removeModule:function(){this.remove()},is_latlng:function(e){var t=e.split(","),i=!_.isUndefined(t[0])&&parseFloat(t[0]),o=!_.isUndefined(t[1])&&parseFloat(t[1]);return!(!i||_.isNaN(i)||!o||_.isNaN(o))&&new google.maps.LatLng(i,o)},renderMap:function(){if(this_el=this,$map=this.$el.find(".mhc-map"),$map.length){view_cid=this.view_cid;var e=this.$el.find(".mhc_address"),t=this.$el.find(".mhc_address_lat"),i=this.$el.find(".mhc_address_lng"),o=this.$el.find(".mhc_find_address"),n=this.$el.find(".mhc_zoom_level"),s=new google.maps.Geocoder,a={},l=function(e){$map.map.setCenter(e)},d=function(){$map.map.setZoom(parseInt(n.val()))};e.on("blur",function(){var o=e.val();o.length<=0||s.geocode({address:o},function(n,s){if(s==google.maps.GeocoderStatus.OK){var a=n[0],d=a.geometry.location,c=this_el.is_latlng(o);c&&(d=c),isNaN(d.lat())||isNaN(d.lng())?alert(mhc_options.map_pin_address_invalid):(e.val(a.formatted_address),t.val(d.lat()),i.val(d.lng()),l(d))}else alert(mhc_options.geocode_error+": "+s)})}),o.on("click",function(e){e.preventDefault()}),n.on("blur",d),setTimeout(function(){$map.map=new google.maps.Map($map[0],{zoom:parseInt(n.val()),mapTypeId:google.maps.MapTypeId.ROADMAP}),""!=t.val()&&""!=i.val()&&l(new google.maps.LatLng(t.val(),i.val())),""!=n&&d(),setTimeout(function(){var e=z.getChildViews(view_cid);_.size(e)&&_.each(e,function(e,t){_.isUndefined(e.model.get("mhc_pin_address_lat"))||_.isUndefined(e.model.get("mhc_pin_address_lng"))||(a[t]=new google.maps.Marker({map:$map.map,position:position,position:new google.maps.LatLng(parseFloat(e.model.get("mhc_pin_address_lat")),parseFloat(e.model.get("mhc_pin_address_lng"))),title:e.model.get("mhc_title"),icon:{url:mhc_options.images_uri+"/marker.png",size:new google.maps.Size(46,43),anchor:new google.maps.Point(16,43)},shape:{coord:[1,1,46,43],type:"rect"}}))})},500),google.maps.event.addListener($map.map,"center_changed",function(){var e=$map.map.getCenter();t.val(e.lat()),i.val(e.lng())}),google.maps.event.addListener($map.map,"zoom_changed",function(){var e=$map.map.getZoom();n.val(e)})},200)}}}),MH_PageComposer.AdvancedModuleSettingsView=window.wp.Backbone.View.extend({initialize:function(){this.listenTo(E,"mh-advanced-module:updated",this.generateContent),this.listenTo(E,"mh-modal-view-removed",this.removeModule),this.module_type=this.$el.data("module_type"),MH_PageComposer.Events=E,this.child_views=[],this.$el.attr("data-cid",this.attributes.cid),this.$sortable_options=this.$el.find(".mhc-sortable-options"),this.$content_textarea=this.$el.siblings(".mhc-option-main-content").find("#mhc_content_main"),this.$sortable_options.sortable({axis:"y",cancel:".mhc-advanced-setting-remove, .mhc-advanced-setting-options",update:function(e,t){E.trigger("mh-advanced-module:updated"),E.trigger("mh-advanced-module:updated_order")}}),this.$add_sortable_item=this.$el.find(".mhc-add-sortable-option").addClass("mhc-add-sortable-initial")},events:{"click .mhc-add-sortable-option":"addModule","click .mhc-advanced-setting-clone":"cloneModule"},render:function(){return this},addModule:function(e){e.preventDefault(),this.model.collection.add([{type:"module",module_type:this.module_type,cid:z.generateNewId(),view:this,created:"manually",mode:"advanced",parent:this.attributes.cid,parent_cid:this.model.model.attributes.cid}],{update_shortcodes:"false"}),this.$add_sortable_item.removeClass("mhc-add-sortable-initial"),E.trigger("mh-advanced-module:updated_order")},cloneModule:function(t){t.preventDefault();var i=e(t.target).closest("li").data("cid"),o=F.collection.find(function(e){return e.get("cid")==i}),n=_.clone(o.attributes);n.created="manually",n.cloned_cid=i,n.cid=z.generateNewId(),this.model.collection.add(n),E.trigger("mh-advanced-module:updated"),E.trigger("mh-advanced-module:saved"),E.trigger("mh-advanced-module:updated_order")},generateContent:function(){var t="";this.$sortable_options.find("li").each(function(){var i=e(this);t+=F.generateModuleShortcode(i,!1)}),t=t.replace(/%22/g,"^^"),this.$content_textarea.html(t),this.$sortable_options.find("li").length?this.$add_sortable_item.removeClass("mhc-add-sortable-initial"):this.$add_sortable_item.addClass("mhc-add-sortable-initial")},generateAdvancedSortableItems:function(e,t){var i=this,o=F.getShortCodeChildTags(),n=window.wp.shortcode.regexp(o),s=F.wp_regexp_not_shared(o),a=e.match(n);""!==e&&this.$add_sortable_item.removeClass("mhc-add-sortable-initial"),_.each(a,function(e){var o,a=e.match(s),l=a[2],d=""!==a[3]?window.wp.shortcode.attrs(a[3]):"",c=a[5],r=(z.generateNewId(),{}),h=void 0!==c&&""!==c&&c.match(n);if(o={type:"module",module_type:t,cid:z.generateNewId(),view:i,created:"auto",mode:"advanced",parent:i.attributes.cid,parent_cid:i.model.model.attributes.cid},_.isObject(d.named)){for(var m in d.named){var p,u="admin_label"!==m?"mhc_"+m:m;"column"===l&&"mhc_type"===u&&(u="layout"),p=(p=d.named[m]).replace(/\^\^/g,'"'),r[u]=p}o.mhc_content_new=c,o=_.extend(o,r)}h||(o.mhc_content_new=c),i.model.collection.add([o],{update_shortcodes:"false"})})},removeModule:function(){_.each(this.child_views,function(e){e.removeView()}),this.remove()}}),MH_PageComposer.AdvancedModuleSettingView=window.wp.Backbone.View.extend({tagName:"li",initialize:function(){this.template=_.template(e("#mh-composer-advanced-setting").html())},events:{"click .mhc-advanced-setting-options":"showSettings","click .mhc-advanced-setting-remove":"removeView"},render:function(){var e;return this.$el.html(this.template(this.model.attributes)),e=new MH_PageComposer.AdvancedModuleSettingTitleView({model:this.model,view:this}),this.$el.prepend(e.render().el),this.child_view=e,void 0!==this.model.get("cloned_cid")&&""!==this.model.get("cloned_cid")||this.showSettings(),this},showSettings:function(t){var i;t&&t.preventDefault(),i=new MH_PageComposer.AdvancedModuleSettingEditViewContainer({view:this,attributes:{show_settings_clicked:!!t}}),e(".mhc_modal_settings_container").after(i.render().el)},removeView:function(e){e&&e.preventDefault(),this.child_view.remove(),this.remove(),this.model.destroy(),E.trigger("mh-advanced-module:updated"),E.trigger("mh-advanced-module:updated_order")}}),MH_PageComposer.AdvancedModuleSettingTitleView=window.wp.Backbone.View.extend({tagName:"span",className:"mh-sortable-title",initialize:function(){template_name="#mh-composer-advanced-setting-"+this.model.get("module_type")+"-title",this.template=_.template(e(template_name).html()),this.listenTo(E,"mh-advanced-module:updated",this.render)},render:function(){return _.isUndefined(this.model.attributes.mhc_admin_title)||""!==this.model.attributes.mhc_admin_title||delete this.model.attributes.mhc_admin_title,this.$el.html(this.template(this.model.attributes)),this}}),MH_PageComposer.AdvancedModuleSettingEditViewContainer=window.wp.Backbone.View.extend({className:"mhc_modal_settings_container",initialize:function(){this.template=_.template(e("#mh-composer-advanced-setting-edit").html()),this.model=this.options.view.model,this.listenTo(E,"mh-modal-view-removed",this.removeView)},events:{"click .mhc-modal-save":"saveSettings","click .mhc-modal-close":"removeView"},is_latlng:function(e){var t=e.split(","),i=!_.isUndefined(t[0])&&parseFloat(t[0]),o=!_.isUndefined(t[1])&&parseFloat(t[1]);return!(!i||_.isNaN(i)||!o||_.isNaN(o))&&new google.maps.LatLng(i,o)},render:function(){var t,i,a,l,d,c,r,h=this.model.attributes.cid,m=this;if(this.$el.html(this.template()),this.$el.addClass("mhc_modal_settings_container_step2"),("auto"!==this.model.get("created")||this.attributes.show_settings_clicked)&&(t=new MH_PageComposer.AdvancedModuleSettingEditView({view:this}),this.$el.append(t.render().el),this.child_view=t),MH_PageComposer.Events.trigger("mh-advanced-module-settings:render",this),i=this.$el.find(".mhc-color-picker-hex"),$color_picker_alpha=this.$el.find(".mh-composer-color-picker-alpha"),i.length&&i.wpColorPicker({defaultColor:i.data("default-color"),palettes:mhc_options.default_color_scheme.split("|"),change:function(t,i){var o=e(this),n=o.closest(".mhc-option-container").find(".mhc-reset-setting"),s=o.closest(".mhc-custom-color-container"),a=o.val();s.length&&s.find(".mhc-custom-color-picker").val(i.color.toString()),n.length&&(a!==b(o)?n.addClass("mhc-reset-icon-visible"):n.removeClass("mhc-reset-icon-visible"))}}),$color_picker_alpha.length&&$color_picker_alpha.each(function(){var t=e(this),i=t.data("value").split("|"),o=i[0]||"#444444",n=i[2]||1;t.attr("data-opacity",n),t.val(o),t.minicolors({control:"hue",defaultValue:e(this).data("default-color")||"",opacity:!0,changeDelay:200,show:function(){t.minicolors("opacity",t.data("opacity"))},change:function(i,o){if(i){var n,s=t.minicolors("rgbObject"),a=e(t.data("field")),l=[];l.push(i),l.push(s.r+", "+s.g+", "+s.b),l.push(o),n=l.join("|"),a.length&&a.val(n)}},theme:"bootstrap"})}),(a=this.$el.find(".mhc-upload-button")).length&&o(a),(l=this.$el.find(".mhc-video-image-button")).length&&s(l),(d=this.$el.find(".mhc-map")).length){var _,p,u=this.$el.find(".mhc_pin_address"),g=this.$el.find(".mhc_pin_address_lat"),v=this.$el.find(".mhc_pin_address_lng"),f=this.$el.find(".mhc_find_address"),w=this.$el.find(".mhc_zoom_level"),k=new google.maps.Geocoder,C=function(e){p.setPosition(e),_.setCenter(e)};u.on("change",function(){var e=u.val().trim();e.length<=0||k.geocode({address:e},function(t,i){if(i==google.maps.GeocoderStatus.OK){var o=t[0],n=o.geometry.location,s=m.is_latlng(e);s&&(n=s),isNaN(n.lat())||isNaN(n.lng())?alert(mhc_options.map_pin_address_invalid):(u.val(o.formatted_address),g.val(n.lat()),v.val(n.lng()),C(n))}else alert(mhc_options.geocode_error+": "+i)})}),f.on("click",function(e){e.preventDefault()}),setTimeout(function(){_=new google.maps.Map(d[0],{zoom:parseInt(w.val()),mapTypeId:google.maps.MapTypeId.ROADMAP}),p=new google.maps.Marker({map:_,draggable:!0,icon:{url:mhc_options.images_uri+"/marker.png",size:new google.maps.Size(46,43),anchor:new google.maps.Point(16,43)},shape:{coord:[1,1,46,43],type:"rect"}}),google.maps.event.addListener(p,"dragend",function(){var e=p.getPosition();g.val(e.lat()),v.val(e.lng()),C(e),latlng=new google.maps.LatLng(e.lat(),e.lng()),k.geocode({latLng:latlng},function(e,t){t==google.maps.GeocoderStatus.OK?e[0]?u.val(e[0].formatted_address):alert(mhc_options.no_results):alert(mhc_options.geocode_error_2+": "+t)})}),""!=g.val()&&""!=v.val()&&C(new google.maps.LatLng(g.val(),v.val()))},200)}if($gallery_button=this.$el.find(".mhc-gallery-button"),$gallery_button.length&&n($gallery_button),(c=this.$el.find(".mhc-social-network")).length){var S=this.$el.find(".reset-default-color"),$=this.$el.find("#mhc_bg_color");S.length&&S.click(function(){$main_settings=S.parents(".mhc-main-settings"),c=$main_settings.find(".mhc-social-network"),($=$main_settings.find("#mhc_bg_color")).length&&($.wpColorPicker("color",c.find("option:selected").data("color")),S.css("display","none"))}),c.change(function(){if($main_settings=c.parents(".mhc-main-settings"),c.val().length){var e=$main_settings.find("#mhc_content_new"),t=$main_settings.find("#mhc_bg_color");e.length&&e.val(c.find("option:selected").text()),t.length&&t.wpColorPicker("color",c.find("option:selected").data("color"))}}),$.val()!==c.find("option:selected").data("color")&&S.css("display","inline")}if((r=this.$el.find(".mhc-icon")).length){var M=this;r.each(function(){function t(){""!==l&&(-1!==l.search(/^%%/)?(n=parseInt(l.replace(/%/g,"")),i=s.find("li").eq(n)):i=s.find('li[data-icon="'+l+'"]'),i.addClass(c),s.is(":visible")&&setTimeout(function(){(o=i.offset().top-s.offset().top)>0&&s.animate({scrollTop:o},0)},110))}var i,o,n,s=e(this),a=s.siblings(".mhc-font-icon"),l=e.trim(a.val()),d=s.find("li"),c="mh_active";t(),M.$el.find(".mhc-options-tabs-links").on("mhc_main_tab:changed",t),d.click(function(){var t=e(this),i=t.index();if(t.hasClass(c))return!1;t.siblings("."+c).removeClass(c).end().addClass(c),i="%%"+i+"%%",a.val(i)})})}return function(t,i){var o=t.find(".mhc-options-tab-advanced"),n=o.find(".mhc-main-setting"),s=(e(".mhc_modal_settings_container:not(.mhc_modal_settings_container_step2)").find(".mhc-options-tab-advanced"),j.findWhere({cid:i}));o.length&&n.each(function(){var t=e(this);t.hasClass("mhc-range")&&t.siblings(".mhc-range-input").each(function(){var t=e(this),i=t.attr("id"),o=e("#"+i);o.length&&(s.attributes.module_defaults=s.attributes.module_defaults||[],s.attributes.module_defaults[i]=o.val(),t.data("default_inherited",o.val()),t.data("default",o.val()))})})}(this.$el,h),y(this.$el,h),this},removeView:function(e){e&&e.preventDefault(),this.$el.find("#mhc_content_new")&&e&&f("mhc_content_new"),S(this),this.child_view&&this.child_view.remove(),this.remove()},saveSettings:function(t){var i=this,o={},n=this.model.get("module_defaults")||"";t.preventDefault(),this.$("input, select, textarea").each(function(){var t,s=e(this),a=s.attr("id");return void 0===a||-1!==a.indexOf("qt_")&&"button"===s.attr("type")||(a=s.attr("id").replace("data.",""),t=s.is("#mhc_content_new")?p("mhc_content_new"):s.val(),""!==n&&void 0!==n[a]&&n[a]===t?(i.model.unset(a),!0):void(o[a]=t))}),_.isUndefined(o.mhc_pin_address)||_.isUndefined(o.mhc_pin_address_lat)||_.isUndefined(o.mhc_pin_address_lng)||""!==o.mhc_pin_address&&""!==o.mhc_pin_address_lat&&""!==o.mhc_pin_address_lng?(this.model.set(o,{silent:!0}),E.trigger("mh-advanced-module:updated"),E.trigger("mh-advanced-module:saved"),f("mhc_content_new"),this.removeView()):alert(mhc_options.map_pin_address_error)}}),MH_PageComposer.AdvancedModuleSettingEditView=window.wp.Backbone.View.extend({className:"mhc_module_settings",initialize:function(){this.model=this.options.view.options.view.model,this.template=_.template(e("#mh-composer-advanced-setting-"+this.model.get("module_type")).html())},events:{},render:function(){var e,t,i=this.$el;return this.$el.html(this.template({data:this.model.toJSON()})),this.$el.find(".mhc-main-settings").addClass("mhc-main-settings-advanced"),(e=this.$el.find("div#mhc_content_new")).length&&(t=e.closest(".mhc-option-container"),content=e.html(),e.remove(),t.prepend(q),setTimeout(function(){void 0!==window.switchEditors&&window.switchEditors.go("mhc_content_new",u()),v("mhc_content_new",content),window.wpActiveEditor="mhc_content_new"},300)),setTimeout(function(){i.find("select, input, textarea, radio").filter(":eq(0)").focus()},1),this}}),MH_PageComposer.BlockModuleView=window.wp.Backbone.View.extend({className:function(){var e="mhc_module_block";return void 0!==this.model.attributes.className&&(e+=this.model.attributes.className),e},template:_.template(e("#mh-composer-block-module-template").html()),initialize:function(){this.listenTo(this.model,"change:admin_label",this.renameModule),this.listenTo(this.model,"change:mhc_disabled",this.toggleDisabledClass),this.listenTo(this.model,"change:mhc_shared_module",this.removeShared)},events:{"click .mhc-settings":"showSettings","click .mhc-clone-module":"cloneModule","click .mhc-remove-module":"removeModule","click .mhc-unlock":"unlockModule",contextmenu:"showRightClickOptions",click:"hideRightClickOptions"},render:function(){var e=z.getParentViews(this.model.get("parent"));return this.$el.html(this.template(this.model.attributes)),(void 0!==this.model.attributes.mhc_shared_module||void 0!==this.model.attributes.mhc_template_type&&"module"===this.model.attributes.mhc_template_type&&"shared"===mhc_options.is_shared_template)&&this.$el.addClass("mhc_shared"),void 0!==this.model.get("mhc_locked")&&"on"===this.model.get("mhc_locked")&&_.each(e,function(e){e.$el.addClass("mhc_children_locked")}),void 0!==this.model.get("mhc_parent_locked")&&"on"===this.model.get("mhc_parent_locked")&&this.$el.addClass("mhc_parent_locked"),z.isModuleFullwidth(this.model.get("module_type"))&&this.$el.addClass("mhc_fullwidth_module"),void 0!==this.model.get("pasted_module")&&this.model.get("pasted_module")&&c(this.$el),this},cloneModule:function(e){var t,i="",o={model:this.model,view:this.$el,view_event:e};e.preventDefault(),this.isModuleLocked()||(void 0!==this.model.get("mhc_shared_module")&&(i=this.model.get("cid")),t=new MH_PageComposer.RightClickOptionsView(o,!0),F.allowHistorySaving("cloned","module",this.model.get("admin_label")),t.copy(e),t.pasteAfter(e),""!==i&&R(i))},renameModule:function(){this.$(".mhc-module-title").html(this.model.get("admin_label"))},removeShared:function(){this.isModuleLocked()||void 0===this.model.get("mhc_shared_module")&&this.$el.removeClass("mhc_shared")},toggleDisabledClass:function(){void 0!==this.model.get("mhc_disabled")&&"on"===this.model.get("mhc_disabled")?this.$el.addClass("mhc_disabled"):this.$el.removeClass("mhc_disabled")},showSettings:function(t){var o,n=this,s={model:this.model,collection:this.collection,attributes:{"data-open_view":"module_settings"},triggered_by_right_click:this.triggered_by_right_click,do_preview:this.do_preview};if(void 0!==t&&t.preventDefault(),i(),!this.isModuleLocked()){if(void 0!==this.model.get("mhc_shared_module")&&""!==this.model.get("mhc_shared_module"))!function(t){var i;e.ajax({type:"POST",url:mhc_options.ajaxurl,dataType:"json",data:{action:"mhc_get_shared_module",mh_admin_load_nonce:mhc_options.mh_admin_load_nonce,mh_shared_id:t.model.get("mhc_shared_module")},beforeSend:function(){E.trigger("mhc-loading:started")},complete:function(){E.trigger("mhc-loading:ended")},success:function(o){if(o.error)t.model.unset("mhc_shared_module"),t.model.unset("mhc_saved_tabs");else{var n=F.getShortCodeParentTags(),s=window.wp.shortcode.regexp(n),a=F.wp_regexp_not_shared(n),l=o.shortcode.match(s);_.each(l,function(e){var i=e.match(a),o=(i[2],""!==i[3]?window.wp.shortcode.attrs(i[3]):""),n=i[5],l=(void 0!==n&&""!==n&&n.match(s),o.named.saved_tabs||t.model.get("mhc_saved_tabs")||""),d="all"!==l&&-1===l.indexOf("general");if(_.isObject(o.named))for(var c in o.named)if("template_type"!==c&&("admin_label"!==c||"admin_label"===c&&!d)){var r="admin_label"!==c?"mhc_"+c:c;""!==c&&t.model.set(r,o.named[c],{silent:!0})}""===l||"general"!==l&&"all"!==l||t.model.set("mhc_content_new",n,{silent:!0})})}i=new MH_PageComposer.ModalView(t),e("body").append(i.render().el),!0===t.triggered_by_right_click&&!0===t.do_preview&&e(".mhc-modal-preview-template").trigger("click");var d=t.model.get("mhc_saved_tabs");void 0!==d&&(d="all"===d?["general","advanced","css"]:d.split(","),_.each(d,function(t){e(".mhc_options_tab_"+(t="css"===t?"custom_css":t)).addClass("mhc_saved_shared_tab")}),e(".mhc_modal_settings_container").addClass("mhc_saved_shared_modal"))}})}(s),this.triggered_by_right_click=void 0,this.do_preview=void 0;else{if(o=new MH_PageComposer.ModalView(s),mh_modal_view_rendered=o.render(),!1===mh_modal_view_rendered)return setTimeout(function(){n.showSettings()},500),void E.trigger("mhc-loading:started");E.trigger("mhc-loading:ended"),e("body").append(mh_modal_view_rendered.el)}if(D(),void 0!==this.model.get("mhc_shared_parent")&&""!==this.model.get("mhc_shared_parent")||z.getView(this.model.get("cid")).$el.closest(".mhc_shared").length){e(".mhc_modal_settings_container").addClass("mhc_saved_shared_modal");_.each(["general","advanced","custom_css"],function(t){e(".mhc_options_tab_"+t).addClass("mhc_saved_shared_tab")})}}},removeModule:function(e){var t="";this.isModuleLocked()||(e&&(e.preventDefault(),(this.$el.closest(".mhc_section.mhc_shared").length||this.$el.closest(".mhc_row.mhc_shared").length)&&""===mhc_options.template_post_id&&(t=this.model.get("shared_parent_cid"))),this.model.destroy(),F.allowHistorySaving("removed","module",this.model.get("admin_label")),z.removeView(this.model.get("cid")),this.remove(),e&&E.trigger("mh-module:removed"),""!==t&&R(t))},unlockModule:function(e){e.preventDefault();var t,i=this,o=i.$el.closest(".mhc_module_block");I().done(function(e){!0===e?(o.removeClass("mhc_locked"),i.options.model.attributes.mhc_locked="off",t=z.getParentViews(i.model.get("parent")),_.each(t,function(e,t){z.isChildrenLocked(e.model.get("cid"))||e.$el.removeClass("mhc_children_locked")}),F.allowHistorySaving("unlocked","module",i.options.model.get("admin_label")),F.saveAsShortcode()):alert(mhc_options.locked_module_permission_alert)})},isModuleLocked:function(){return"on"===this.model.get("mhc_locked")||"on"===this.model.get("mhc_parent_locked")},showRightClickOptions:function(e){e.preventDefault();var t={model:this.model,view:this.$el,view_event:e};new MH_PageComposer.RightClickOptionsView(t)},hideRightClickOptions:function(e){e.preventDefault(),i()}}),MH_PageComposer.RightClickOptionsView=window.wp.Backbone.View.extend({tagName:"div",id:"mh-composer-right-click-controls",template:_.template(e("#mh-composer-right-click-controls-template").html()),events:{"click .mhc-right-click-rename":"rename","click .mhc-right-click-save-to-vault":"saveToVault","click .mhc-right-click-undo":"undo","click .mhc-right-click-redo":"redo","click .mhc-right-click-disable":"disable","click .mhc_disable_on_option":"disable_device","click .mhc-right-click-lock":"lock","click .mhc-right-click-collapse":"collapse","click .mhc-right-click-copy":"copy","click .mhc-right-click-paste-after":"pasteAfter","click .mhc-right-click-paste-app":"pasteApp","click .mhc-right-click-paste-column":"pasteColumn","click .mhc-right-click-preview":"preview","click .mhc-right-click-disable-shared":"disableShared"},initialize:function(t,i){var o,i=!_.isUndefined(i)&&i;if(this.type=this.options.model.attributes.type,this.mhc_has_storage_support=N(),this.has_compatible_clipboard_content=MHC_Clipboard.get(this.getClipboardType()),this.history_noun="row_inner"===this.type?"row":this.type,"1"===mhc_options.is_mharty_vault&&!1!==this.has_compatible_clipboard_content){switch(mhc_options.layout_type){case"module":o=[];break;case"row":o=["module"];break;case"section":o=["module","row"];break;default:o=["module","row","section"]}-1==e.inArray(this.type,o)&&(this.has_compatible_clipboard_content=!1)}!1===i&&this.render()},render:function(){var t=e(this.options.view),i=this.$el.html(this.template()),o=this.options.view.offset(),n=this.options.view_event.pageX-o.left-200,s=this.options.view_event.pageY-o.top;this.closeAllRightClickOptions(),e(this.options.view_event.toElement).is("#mh-composer-right-click-controls a")||i.find("li").length<1||(t.append(i),i.find(".options").css({top:s,left:n,"margin-top":0-i.find(".options").height()-40}).animate({"margin-top":0-i.find(".options").height()-10,opacity:1},300),e("#mhc_layout").prepend('<div id="mhc_layout_right_click_overlay" />'))},closeAllRightClickOptions:function(){return i(),!1},rename:function(e){e.preventDefault();this.$el.parent();d("rename_admin_label",this.options.model.attributes.cid),this.closeAllRightClickOptions()},disableShared:function(e){e.preventDefault(),this.closeAllRightClickOptions(),z.removeSharedAttributes(this),M()},saveToVault:function(t){t.preventDefault();var i=this.options.model,o=(i.attributes.type,{model:i,collection:j,attributes:{"data-open_view":"module_settings"}});this.closeAllRightClickOptions(),"app"===this.type?d("save_layout"):(modal_view=new MH_PageComposer.ModalView(o),e("body").append(modal_view.render().el),D(),modal_view.saveTemplate(t))},undo:function(e){e.preventDefault(),F.undo(e),this.closeAllRightClickOptions()},redo:function(e){e.preventDefault(),F.redo(e),this.closeAllRightClickOptions()},disable:function(e){e.preventDefault();var t,i=this.$el.parent();this.options.model.attributes.cid;return i.hasClass("mhc_disabled")?(i.removeClass("mhc_disabled"),this.options.model.attributes.mhc_disabled="off",t="enabled"):(parent_background_color=i.css("backgroundColor"),i.addClass("mhc_disabled"),this.options.model.attributes.mhc_disabled="on",t="disabled"),this.updateSharedModule(),this.closeAllRightClickOptions(),F.allowHistorySaving(t,this.history_noun),F.saveAsShortcode(),!1},disable_device:function(t){var i,o,n,s,a=e(t.target),l=(e(this),a.hasClass("mhc_disable_on_active")?"off":"on"),d=void 0!==this.options.model.attributes.mhc_disabled_on?this.options.model.attributes.mhc_disabled_on:"",c=this.$el.parent();return a.hasClass("mhc_disable_on_phone")?(n=0,s="phone"):a.hasClass("mhc_disable_on_tablet")?(n=1,s="tablet"):(n=2,s="desktop"),o=""!==d?d.split("|"):["","",""],o[n]=l,this.options.model.attributes.mhc_disabled_on=o[0]+"|"+o[1]+"|"+o[2],"on"===o[0]&&"on"===o[1]&&"on"===o[2]?(parent_background_color=c.css("backgroundColor"),c.addClass("mhc_disabled"),this.options.model.attributes.mhc_disabled="on",i="disabled"):(c.removeClass("mhc_disabled"),this.options.model.attributes.mhc_disabled="off",i="off"===l?"enabled":"disabled"),a.toggleClass("mhc_disable_on_active"),this.updateSharedModule(),F.allowHistorySaving(i,this.history_noun,void 0,s),F.saveAsShortcode(),!1},lock:function(e){e.preventDefault();this.$el.parent().hasClass("mhc_locked")?(this.unlockItem(),F.allowHistorySaving("unlocked",this.history_noun)):(this.lockItem(),F.allowHistorySaving("locked",this.history_noun)),this.updateSharedModule(),this.closeAllRightClickOptions(),F.saveAsShortcode()},unlockItem:function(){var e,t,i=this,o=i.$el.parent();I().done(function(n){!0===n?(o.removeClass("mhc_locked"),i.options.model.attributes.mhc_locked="off","module"!==i.options.model.get("type")&&(e=z.getChildrenViews(i.model.get("cid")),_.each(e,function(e,t){e.$el.removeClass("mhc_parent_locked"),e.model.set("mhc_parent_locked","off",{silent:!0})})),"section"!==i.options.model.get("type")&&(t=z.getParentViews(i.model.get("parent")),_.each(t,function(e,t){z.isChildrenLocked(e.model.get("cid"))||e.$el.removeClass("mhc_children_locked")})),F.allowHistorySaving("unlocked",i.history_noun),F.saveAsShortcode()):alert(mhc_options.locked_item_permission_alert)})},lockItem:function(){var e,t,i=this,o=i.$el.parent();I().done(function(n){!0===n?(o.addClass("mhc_locked"),i.options.model.attributes.mhc_locked="on","module"!==i.options.model.get("type")&&(e=z.getChildrenViews(i.model.get("cid")),_.each(e,function(e,t){e.$el.addClass("mhc_parent_locked"),e.model.set("mhc_parent_locked","on",{silent:!0})})),"section"!==i.options.model.get("type")&&(t=z.getParentViews(i.model.get("parent")),_.each(t,function(e,t){e.$el.addClass("mhc_children_locked")})),F.allowHistorySaving("locked",i.history_noun),F.saveAsShortcode()):alert(mhc_options.locked_item_permission_alert)})},collapse:function(e){e.preventDefault();var t,i=this.$el.parent();this.options.model.attributes.cid;i.toggleClass("mhc_collapsed"),i.hasClass("mhc_collapsed")?(this.options.model.attributes.mhc_collapsed="on",t="collapsed"):(this.options.model.attributes.mhc_collapsed="off",t="expanded"),this.updateSharedModule(),this.closeAllRightClickOptions(),F.allowHistorySaving(t,this.history_noun),F.saveAsShortcode()},copy:function(e){e.preventDefault();var t,i=_.clone(this.model.attributes),o=i.type;"row_inner"===o&&(o="row"),_.isUndefined(i.view)||delete i.view,_.isUndefined(i.appendAfter)||delete i.appendAfter,"row"!==o&&"section"!==o||(i.childviews=this.getChildViews(i.cid)),i.created="manually",t=JSON.stringify(i),MHC_Clipboard.set(this.getClipboardType(),t),this.closeAllRightClickOptions()},pasteAfter:function(e,t,i,o){e.preventDefault();var n,t=_.isUndefined(t)?this.model.get("parent"):t,i=_.isUndefined(i)?this.getClipboardType():i,o=!!_.isUndefined(o)||o;n=MHC_Clipboard.get(i),n=JSON.parse(n),o&&(n.cloned_cid=this.model.get("cid")),this.setPasteViews(n,t,"main_parent"),E.trigger("mh-advanced-module:updated"),E.trigger("mh-advanced-module:saved"),this.updateSharedModule(),this.closeAllRightClickOptions(),"did"===W.verb&&F.allowHistorySaving("copied",this.history_noun),F.saveAsShortcode()},pasteApp:function(e){e.preventDefault();var t=j.where({type:"section"}),i=_.last(t);this.model=i,this.options.model=i,this.pasteAfter(e,void 0,"mhc_clipboard_section",!1)},pasteColumn:function(e){e.preventDefault();var t=this.model.get("cid"),i="section"===this.model.get("type")?"mhc_clipboard_module_fullwidth":"mhc_clipboard_module";this.pasteAfter(e,t,i,!1)},getClipboardType:function(){var e="mhc_clipboard_"+this.model.attributes.type;return"mhc_fullwidth"===(_.isUndefined(this.model.attributes.module_type)?this.model.attributes.type:this.model.attributes.module_type).substr(0,"mhc_fullwidth".length)&&(e+="_fullwidth"),e},getChildViews:function(e){var t,i=this,o=j.models,n=[];return _.each(o,function(o,s){o.attributes.parent===e&&(t=o.attributes,_.isUndefined(t.view)||delete t.view,_.isUndefined(t.appendAfter)||delete t.appendAfter,t.created="manually",t.childviews=i.getChildViews(o.attributes.cid),n.push(t))}),n},setPasteViews:function(e,t,i){var o=this,n=z.generateNewId(),s=this.model.collection.indexOf(this.model),a=!(_.isUndefined(e.childviews)||!_.isArray(e.childviews))&&e.childviews;e.cid=n,e.parent=t,e.pasted_module=void 0!==i&&"main_parent"===i,!_.isUndefined(e.mhc_shared_module)&&_.isUndefined(e.shared_parent_cid)&&_.isUndefined(this.set_shared_parent_cid)&&(this.shared_parent_cid=n,this.set_shared_parent_cid=!0),_.isUndefined(e.shared_parent_cid)||(e.shared_parent_cid=this.shared_parent_cid),_.each(["mhc_shared_parent","shared_parent_cid"],function(t){!_.isUndefined(o.options.model.get(t))&&_.isUndefined(e[t])&&(e[t]=o.options.model.get(t))}),_.isUndefined(e.mhc_template_type)||delete e.mhc_template_type,delete e.childviews,this.model.collection.add(e,{at:s}),a&&_.each(a,function(e){o.setPasteViews(e,n)})},updateSharedModule:function(){var e;z.is_shared(this.model)?z.is_shared_children(this.model)||(e=this.options.model.get("shared_parent_cid")):e=this.options.model.get("cid"),_.isUndefined(e)||R(e)},hasOption:function(e){"function"==typeof this.model.get&&this.model.get("cid");var t=!1;this.options.model.attributes.type;switch(e){case"rename":this.hasOptionSupport(["module","section","row_inner","row"])&&"on"!==this.options.model.attributes.mhc_locked&&(t=!0);break;case"save-to-vault":!this.hasOptionSupport(["app","section","row_inner","row","module"])||z.is_shared(this.options.model)||z.is_shared_children(this.options.model)||"on"===this.options.model.attributes.mhc_locked||"1"===mhc_options.is_mharty_vault||(t=!0);break;case"disable-shared":this.hasOptionSupport(["section","row_inner","row","module"])&&(z.is_shared(this.options.model)||z.is_shared_children(this.options.model))&&(t=!0);break;case"undo":this.hasOptionSupport(["app","section","row_inner","row","column","column_inner","module"])&&this.hasUndo()&&(t=!0);break;case"redo":this.hasOptionSupport(["app","section","row_inner","row","column","column_inner","module"])&&this.hasRedo()&&(t=!0);break;case"disable":this.hasOptionSupport(["section","row_inner","row","module"])&&"on"!==this.options.model.attributes.mhc_locked&&!1===this.hasDisabledParent()&&_.isUndefined(this.model.attributes.mhc_skip_module)&&(t=!0);break;case"lock":this.hasOptionSupport(["section","row_inner","row","module"])&&_.isUndefined(this.model.attributes.mhc_skip_module)&&(t=!0);break;case"collapse":this.hasOptionSupport(["section","row_inner","row"])&&"on"!==this.options.model.attributes.mhc_locked&&_.isUndefined(this.model.attributes.mhc_skip_module)&&(t=!0);break;case"copy":this.hasOptionSupport(["section","row_inner","row","module"])&&this.mhc_has_storage_support&&"on"!==this.options.model.attributes.mhc_locked&&_.isUndefined(this.model.attributes.mhc_skip_module)&&(t=!0);break;case"paste-after":this.hasOptionSupport(["section","row_inner","row","module"])&&this.mhc_has_storage_support&&this.has_compatible_clipboard_content&&"on"!==this.options.model.attributes.mhc_locked&&(t=!0);break;case"paste-app":this.hasOptionSupport(["app"])&&this.mhc_has_storage_support&&MHC_Clipboard.get("mhc_clipboard_section")&&(t=!0);break;case"paste-column":!_.isUndefined(this.model.attributes.is_insert_module)&&(("column"===this.type||"column_inner"==this.type)&&MHC_Clipboard.get("mhc_clipboard_module")||"section"===this.type&&MHC_Clipboard.get("mhc_clipboard_module_fullwidth"))&&this.mhc_has_storage_support&&(t=!0);break;case"preview":this.hasOptionSupport(["section","row_inner","row","module"])&&"on"!==this.options.model.attributes.mhc_locked&&(t=!0)}return t},hasOptionSupport:function(e){return!_.isUndefined(_.findWhere(e,this.type))},hasUndo:function(){return F.hasUndo()},hasRedo:function(){return F.hasRedo()},hasDisabledParent:function(){for(var e=z.getView(this.model.attributes.parent),t={},i=!1;!_.isUndefined(e);)_.isUndefined(e.model.attributes.mhc_disabled)||"on"!==e.model.attributes.mhc_disabled||(i=!0),t[e.model.attributes.cid]=e,e=z.getView(e.model.attributes.parent);return i},preview:function(t){t.preventDefault();var i=z.getView(this.model.get("cid"));this.closeAllRightClickOptions(),i.triggered_by_right_click=!0,i.do_preview=!0,i.showSettings(t),e(".mhc-modal-preview-template").trigger("click")}}),MH_PageComposer.visualizeHistoriesView=window.wp.Backbone.View.extend({el:"#mhc-histories-visualizer",template:_.template(e("#mh-composer-histories-visualizer-item-template").html()),events:{"click li":"rollback"},verb:"did",noun:"module",noun_alias:void 0,getItemID:function(e){return"#mhc-history-"+e.get("timestamp")},getVerb:function(){var e=this.verb;return _.isUndefined(mhc_options.verb[e])||(e=mhc_options.verb[e]),e},getNoun:function(){var e=this.noun;return _.isUndefined(this.noun_alias)?_.isUndefined(mhc_options.noun[e])||(e=mhc_options.noun[e]):e=this.noun_alias,e},addItem:function(e){this.options=e,this.$el.prepend(this.template()),this.setHistoriesHeight()},changeItem:function(t){var i=this.getItemID(t),o=e(i),n=t.collection.findWhere({current_active_history:!0}),s=t.collection.indexOf(n),a=t.collection.indexOf(t);this.options=t,this.$el.find("li").removeClass("undo redo active"),s===a?(o.addClass("active"),this.$el.find("li:lt("+o.index()+")").addClass("redo"),this.$el.find("li:gt("+o.index()+")").addClass("undo")):this.$el.find("li:not( .active, .redo )").addClass("undo"),this.setHistoriesHeight()},removeItem:function(e){var t=this.getItemID(e);this.$el.find(t).remove(),this.setHistoriesHeight()},setHistoryMeta:function(e,t,i){_.isUndefined(e)||(this.verb=e),_.isUndefined(t)||(this.noun=t),_.isUndefined(i)?this.noun_alias=void 0:this.noun_alias=i},setHistoriesHeight:function(){var t=this;setTimeout(function(){var i=e("#mhc_layout"),o=i.find(".hndle"),n=e("#mhc_layout_controls"),s=i.outerHeight()-o.outerHeight()-n.outerHeight();t.$el.css({"max-height":s})},200)},rollback:function(t){t.preventDefault();var i=e(t.target),o=(i.is("li")?i:i.parent("li")).data("timestamp"),n=this.options.collection.findWhere({timestamp:o}),s=n.get("shortcode");F.resetCurrentActiveHistoryMarker(),n.set({current_active_history:!0}),E.trigger("mhc-loading:started"),v("content",s),setTimeout(function(){var t=e("#mhc_layout"),i=t.innerHeight();t.css({height:i}),F.removeAllSections(),F.$el.find(".mhc_section").remove(),F.enable_history=!1,F.createLayoutFromContent(V(s),"","",{is_reinit:"reinit"}),t.css({height:"auto"}),E.trigger("mhc-loading:ended"),F.updateHistoriesButtonState()},600)}}),MH_PageComposer.AppView=window.wp.Backbone.View.extend({el:e("#mhc_main_container"),template:_.template(e("#mh-composer-app-template").html()),template_button:_.template(e("#mh-composer-add-specialty-section-button").html()),events:{"click .mhc-layout-buttons-save":"saveLayout","click .mhc-layout-buttons-load":"loadLayout","click .mhc-layout-buttons-clear":"clearLayout","click .mhc-layout-buttons-history":"toggleHistory","click #mhc-histories-visualizer-overlay":"closeHistory","contextmenu #mhc-histories-visualizer-overlay":"closeHistory","click .mhc-layout-buttons-redo":"redo","click .mhc-layout-buttons-undo":"undo","contextmenu .mhc-layout-buttons-save":"showRightClickOptions","contextmenu .mhc-layout-buttons-load":"showRightClickOptions","contextmenu .mhc-layout-buttons-clear":"showRightClickOptions","contextmenu .mhc-layout-buttons-redo":"showRightClickOptions","contextmenu .mhc-layout-buttons-undo":"showRightClickOptions","contextmenu #mhc_main_container_right_click_overlay":"showRightClickOptions","click #mhc_main_container_right_click_overlay":"hideRightClickOptions"},initialize:function(){this.listenTo(this.collection,"add",this.addModule),this.listenTo(B,"add",this.addVisualizeHistoryItem),this.listenTo(B,"change",this.changeVisualizeHistoryItem),this.listenTo(B,"remove",this.removeVisualizeHistoryItem),this.listenTo(E,"mh-sortable:update",_.debounce(this.saveAsShortcode,128)),this.listenTo(E,"mh-model-changed-position-within-column",_.debounce(this.saveAsShortcode,128)),this.listenTo(E,"mh-module:removed",_.debounce(this.saveAsShortcode,128)),this.listenTo(E,"mhc-loading:started",this.startLoadingAnimation),this.listenTo(E,"mhc-loading:ended",this.endLoadingAnimation),this.listenTo(E,"mhc-content-updated",this.recalculateModulesOrder),this.listenTo(E,"mh-advanced-module:updated_order",this.updateAdvancedModulesOrder),this.listenTo(E,"mhc-content-updated",this.updateYoastContent),this.$composer_toggle_button=e("body").find("#mhc_toggle_composer"),this.$composer_toggle_button_wrapper=e("body").find(".mhc_toggle_composer_wrapper"),this.render(),this.maybeGenerateInitialLayout()},render:function(){return this.$el.html(this.template()),this.makeSectionsSortable(),this.addLoadingAnimation(),e("#mhc_main_container_right_click_overlay").remove(),this.$el.prepend('<div id="mhc_main_container_right_click_overlay" />'),this.updateHistoriesButtonState(),this},addLoadingAnimation:function(){e("body").append('<div id="mhc_loading_animation"></div>'),this.$loading_animation=e("#mhc_loading_animation").hide()},startLoadingAnimation:function(){this.pageComposerIsActive()&&(this.$loading_animation.next().length&&(e("body").append(this.$loading_animation),this.$loading_animation=e("#mhc_loading_animation")),this.$loading_animation.show())},endLoadingAnimation:function(){this.$loading_animation.hide()},pageComposerIsActive:function(){return this.$composer_toggle_button.hasClass("mhc_composer_is_used")||this.$composer_toggle_button_wrapper.hasClass("mhc_composer_is_used")},saveLayout:function(e){e.preventDefault(),i(),d("save_layout")},loadLayout:function(t){t.preventDefault();var o;i(),o=new MH_PageComposer.ModalView({attributes:{"data-open_view":"save_layout"},view:this}),e("body").append(o.render().el)},clearLayout:function(e){e.preventDefault(),i(),d("clear_layout")},getHistoriesCount:function(){return this.options.history.length},getHistoriesIndex:function(){var e=this.options.history.findWhere({current_active_history:!0});return _.isUndefined(e)?this.options.history.models.length-1:this.options.history.indexOf(e)},enableHistory:function(){return!_.isUndefined(this.enable_history)&&this.enable_history},allowHistorySaving:function(e,t,i){this.enable_history=!0,W.setHistoryMeta(e,t,i)},reviseHistories:function(){var e,t=this;if(this.hasRedo()){var i=_.range(this.getHistoriesIndex()+1,this.getHistoriesCount()).reverse();_.each(i,function(i){e=t.options.history.at(i),t.options.history.remove(e)})}this.updateHistoriesButtonState()},resetCurrentActiveHistoryMarker:function(){var e=this.options.history.where({current_active_history:!0});_.isEmpty(e)||_.each(e,function(e){e.set({current_active_history:!1})})},hasUndo:function(){return this.getHistoriesIndex()>0},hasRedo:function(){return this.getHistoriesCount()-this.getHistoriesIndex()>1},hasOverlayRendered:function(){return!!e(".mhc_modal_overlay").length},updateHistoriesButtonState:function(){this.hasUndo()?e(".mhc-layout-buttons-undo").removeClass("disabled"):e(".mhc-layout-buttons-undo").addClass("disabled"),this.hasRedo()?e(".mhc-layout-buttons-redo").removeClass("disabled"):e(".mhc-layout-buttons-redo").addClass("disabled"),this.hasUndo()||this.hasRedo()?e(".mhc-layout-buttons-history").removeClass("disabled"):e(".mhc-layout-buttons-history").addClass("disabled")},getUndoModel:function(){var e=this.options.history.at(this.getHistoriesIndex()-1);return!_.isUndefined(e)&&e},undo:function(t){t.preventDefault();var i,o=this,n=this.getUndoModel();this.hasUndo()&&(_.isUndefined(n)||this.hasOverlayRendered()||(i=n.get("shortcode"),this.resetCurrentActiveHistoryMarker(),n.set({current_active_history:!0}),E.trigger("mhc-loading:started"),v("content",i),setTimeout(function(){var t=e("#mhc_layout"),n=t.innerHeight();t.css({height:n}),F.removeAllSections(),F.$el.find(".mhc_section").remove(),o.enable_history=!1,F.createLayoutFromContent(V(i),"","",{is_reinit:"reinit"}),t.css({height:"auto"}),E.trigger("mhc-loading:ended"),o.updateHistoriesButtonState()},600)))},getRedoModel:function(){var e=this.options.history.at(this.getHistoriesIndex()+1);return!_.isUndefined(e)&&e},toggleHistory:function(t){t.preventDefault();var i=e("#mhc-histories-visualizer");i.hasClass("active")&&(i.addClass("fadeout"),setTimeout(function(){i.removeClass("fadeout")},500)),e(".mhc-layout-buttons-history, #mhc-histories-visualizer, #mhc-histories-visualizer-overlay").toggleClass("active")},closeHistory:function(e){e.preventDefault(),this.toggleHistory(e)},redo:function(t){t.preventDefault();var i,o=this,n=this.getRedoModel();this.hasRedo()&&!_.isUndefined(n)&&n&&(this.hasOverlayRendered()||(this.options.history.indexOf(n),i=n.get("shortcode"),this.resetCurrentActiveHistoryMarker(),n.set({current_active_history:!0}),E.trigger("mhc-loading:started"),v("content",i),setTimeout(function(){var t=e("#mhc_layout"),n=t.innerHeight();t.css({height:n}),F.removeAllSections(),F.$el.find(".mhc_section").remove(),o.enable_history=!1,F.createLayoutFromContent(V(i),"","",{is_reinit:"reinit"}),t.css({height:"auto"}),E.trigger("mhc-loading:ended"),o.updateHistoriesButtonState()},600)))},addHistory:function(e){if(this.enableHistory()){var t=new Date,i=t.getHours()>12?t.getHours()-12:t.getHours(),o=t.getMinutes(),n=t.getHours()>12?"PM":"AM";this.hasRedo()&&this.reviseHistories(),this.resetCurrentActiveHistoryMarker(),this.options.history.add({timestamp:_.now(),datetime:("0"+i).slice(-2)+":"+("0"+o).slice(-2)+" "+n,shortcode:e,current_active_history:!0,verb:W.verb,noun:W.noun},{validate:!0}),W.setHistoryMeta("did","something")}this.updateHistoriesButtonState()},addVisualizeHistoryItem:function(e){W.addItem(e)},changeVisualizeHistoryItem:function(e){W.changeItem(e)},removeVisualizeHistoryItem:function(e){W.removeItem(e)},maybeGenerateInitialLayout:function(){z.generateNewId();var i=this;E.trigger("mhc-loading:started"),setTimeout(function(){var o="";if(void 0!==window.tinyMCE&&window.tinyMCE.get("content")&&!window.tinyMCE.get("content").isHidden()&&!e("iframe#content_ifr").length)return 30<++t?void E.trigger("mhc-loading:ended"):void i.maybeGenerateInitialLayout();""!==(o=p("content",!0))&&i.allowHistorySaving("loaded","page"),i.addHistory(o),i.pageComposerIsActive()?-1===o.indexOf("[mhc_")?F.reInitialize():-1!==o.indexOf("specialty_placeholder")?(i.createLayoutFromContent(V(o)),e(".mhc_section_specialty").append(i.template_button())):i.createLayoutFromContent(V(o)):i.createLayoutFromContent(o),P(u(),"initial_load"),E.trigger("mhc-content-updated"),E.trigger("mhc-loading:ended"),e("#mhc_main_container").addClass("mhc_loading_animation"),setTimeout(function(){e("#mhc_main_container").removeClass("mhc_loading_animation")},500),i.listenTo(i.collection,"change reset add",_.debounce(i.saveAsShortcode,128))},1e3)},wp_regexp_not_shared:_.memoize(function(e){return new RegExp("\\[(\\[?)("+e+")(?![\\w-])([^\\]\\/]*(?:\\/(?!\\])[^\\]\\/]*)*?)(?:(\\/)\\]|\\](?:([^\\[]*(?:\\[(?!\\/\\2\\])[^\\[]*)*)(\\[\\/\\2\\]))?)(\\]?)")}),getShortCodeParentTags:function(){var e="mhc_section|mhc_row|mhc_column|mhc_column_inner|mhc_row_inner".split("|");return e=e.concat(mhc_options.mh_composer_module_parent_shortcodes.split("|")),e=e.join("|")},getShortCodeChildTags:function(){return mhc_options.mh_composer_module_child_shortcodes},getShortCodeRawContentTags:function(){return mhc_options.mh_composer_module_raw_content_shortcodes.split("|")},createLayoutFromContent:function(t,i,o,n){var s=this,a=void 0===o||""===o?this.getShortCodeParentTags():this.getShortCodeChildTags(),l=window.wp.shortcode.regexp(a),d=this.wp_regexp_not_shared(a),c=t.match(l),r=this.getShortCodeRawContentTags(),h=void 0===n?{}:n;_.each(c,function(t){var o,n=t.match(d),a=n[2],c=""!==n[3]?window.wp.shortcode.attrs(n[3]):"",m=n[5],p=z.generateNewId(),u={},g=void 0!==m&&""!==m&&m.match(l),v="";if("mhc_section"!==a&&"mhc_row"!==a&&"mhc_column"!==a&&"mhc_row_inner"!==a&&"mhc_column_inner"!==a||(a=a.replace("mhc_","")),o={type:a,cid:p,created:"manually",module_type:a},void 0!==h.current_row_cid&&""!==h.current_row_cid&&(o.current_row=h.current_row_cid),void 0!==h.shared_id&&""!==h.shared_id&&(o.mhc_shared_module=h.shared_id),void 0!==h.shared_parent&&""!==h.shared_parent&&(o.mhc_shared_parent=h.shared_parent,o.shared_parent_cid=h.shared_parent_cid),"section"===a&&void 0!==h.after_section&&""!==h.after_section&&(o.after_section=h.after_section),"section"!==a&&(o.parent=i),-1!==a.indexOf("mhc_")?(o.type="module",o.admin_label=z.getTitleByShortcodeTag(a)):o.admin_label=a,_.isObject(c.named)){v=void 0!==c.named.shared_module&&""===v?c.named.shared_module:v;for(var f in c.named)if(void 0===h.ignore_template_tag||""===h.ignore_template_tag||"ignore_template"===h.ignore_template_tag&&"template_type"!==f){var w="admin_label"!==f&&"specialty_columns"!==f?"mhc_"+f:f;"column"!==a&&"column_inner"!==a||"mhc_type"!==w||(w="layout"),u[w]=c.named[f]}o=_.extend(o,u)}if(void 0!==o.specialty_columns&&(o.layout_specialty="1",o.specialty_columns=parseInt(o.specialty_columns)),g||(e.inArray(a,r)>-1?o.mhc_raw_content=_.unescape(m):o.mhc_content_new=m),"undefined"!==!o.mhc_disabled&&"on"===o.mhc_disabled&&(o.className=" mhc_disabled"),"undefined"!==!o.mhc_locked&&"on"===o.mhc_locked&&(o.className=" mhc_locked"),s.collection.add([o]),"reinit"===h.is_reinit||""===v||""!==v&&"row"!==a&&"row_inner"!==a&&"section"!==a){if(g){var y=void 0===h.shared_parent||""===h.shared_parent?v:h.shared_parent,b=void 0===h.shared_parent_cid||""===h.shared_parent_cid?void 0!==v&&""!==v?p:"":h.shared_parent_cid;s.createLayoutFromContent(m,p,"",{is_reinit:h.is_reinit,shared_parent:y,shared_parent_cid:b})}}else ne++,function(t,i){e("body").find(".mhc_shared_loading_overlay").length||e("body").append('<div class="mhc_shared_loading_overlay"></div>'),e.ajax({type:"POST",url:mhc_options.ajaxurl,dataType:"json",data:{action:"mhc_get_shared_module",mh_admin_load_nonce:mhc_options.mh_admin_load_nonce,mh_shared_id:t},success:function(o){if(o.error){var n=z.getView(i),s=n.$el.find("[data-cid]");n.model.unset("mhc_shared_module"),s.length&&s.each(function(){var t=e(this).data("cid");if(void 0!==t&&""!==t){var i=z.getView(t);void 0!==i&&i.model.unset("mhc_shared_parent")}})}else F.createLayoutFromContent(o.shortcode,"","",{ignore_template_tag:"ignore_template",current_row_cid:i,shared_id:t,is_reinit:"reinit"});ne===++se&&(M(),setTimeout(function(){e("body").find(".mhc_shared_loading_overlay").remove()},650))}})}(v,p),s.createLayoutFromContent(m,p,"",{is_reinit:"reinit"})})},addModule:function(t){var i,o,n,s={model:t,collection:j},a=void 0!==t.get("cloned_cid")&&t.get("cloned_cid");switch(t.get("type")){case"section":if(i=new MH_PageComposer.SectionView(s),z.addView(t.get("cid"),i),_.isUndefined(t.get("view"))?void 0!==t.get("after_section")&&""!==t.get("after_section")?z.getView(t.get("after_section")).$el.after(i.render().el):void 0!==t.get("current_row")?this.replaceElement(t.get("current_row"),i):a?this.$el.find('div[data-cid="'+a+'"]').closest(".mhc_section").after(i.render().el):this.$el.append(i.render().el):t.get("view").$el.after(i.render().el),"on"===t.get("mhc_fullwidth")){e(i.render().el).addClass("mhc_section_fullwidth");var l=new MH_PageComposer.ColumnView(s);i.addChildView(l),e(i.render().el).find(".mhc-section-content").append(l.render().el)}if("on"===t.get("mhc_specialty")&&"auto"===t.get("created")){e(i.render().el).addClass("mhc_section_specialty");var d;d=new MH_PageComposer.ModalView({model:s.model,collection:s.collection,attributes:{"data-open_view":"column_specialty_settings"},mh_view:i,view:i}),e("body").append(d.render().el)}"manually"!==t.get("created")&&"on"!==t.get("mhc_fullwidth")&&"on"!==t.get("mhc_specialty")&&i.addRow();break;case"row":case"row_inner":i=new MH_PageComposer.RowView(s),z.addView(t.get("cid"),i),_.isUndefined(t.get("current_row"))?_.isUndefined(t.get("appendAfter"))?a?z.getView(t.get("parent")).$el.find('div[data-cid="'+a+'"]').parent().after(i.render().el):z.getView(t.get("parent")).$el.find(".mhc-section-content").length?z.getView(t.get("parent")).$el.find(".mhc-section-content").append(i.render().el):z.getView(t.get("parent")).$el.find("> .mhc-insert-module").hide().end().append(i.render().el):t.get("appendAfter").after(i.render().el):this.replaceElement(t.get("current_row"),i),t.unset("columns_layout"),"manually"===t.get("created")&&"row_inner"===t.get("module_type")&&t.set("view",z.getView(t.get("parent")),{silent:!0});break;case"column":case"column_inner":s.className="mhc-column mhc-column-"+t.get("layout"),_.isUndefined(t.get("layout_specialty"))||"1"!==t.get("layout_specialty")||(s.className+=" mhc-column-specialty"),i=new MH_PageComposer.ColumnView(s),z.addView(t.get("cid"),i),_.isUndefined(t.get("layout_specialty"))?(n=void 0!==(o=z.getView(t.get("parent"))).model.get("columns_layout")?o.model.get("columns_layout")+","+t.get("layout"):t.get("layout"),o.model.set("columns_layout",n),"on"!==z.getView(t.get("parent")).model.get("mhc_specialty")?(z.getView(t.get("parent")).$el.find(".mhc-row-container").append(i.render().el),z.getView(t.get("parent")).toggleInsertColumnButton()):z.getView(t.get("parent")).$el.find(".mhc-section-content").append(i.render().el)):(z.getView(t.get("parent")).$el.find(".mhc-section-content").append(i.render().el),"1"===t.get("layout_specialty")&&("manually"!==t.get("created")&&this.collection.add([{type:"row",module_type:"row",cid:z.generateNewId(),parent:t.get("cid"),view:i,admin_label:mhc_options.noun.row}]),z.getView(t.get("parent")).model.set("specialty_columns",parseInt(t.get("specialty_columns")))));break;case"module":if(s.attributes={"data-cid":t.get("cid")},"advanced"!==t.get("mode")&&"manually"===t.get("created")&&"column_inner"===z.getView(t.get("parent")).model.get("module_type")){var c=z.getView(t.get("parent")).model.get("parent");z.getView(c).$el.find(".mhc-insert-column").hide()}if(void 0!==t.get("mode")&&"advanced"===t.get("mode"))i=new MH_PageComposer.AdvancedModuleSettingView(s),t.attributes.view.child_views.push(i),void 0!==t.get("cloned_cid")&&""!==t.get("cloned_cid")?z.getView(t.get("cloned_cid")).$el.after(i.render().el):z.getView(t.get("parent")).$el.find(".mhc-sortable-options").append(i.render().el),z.addView(t.get("cid"),i);else{var r="";if(E.trigger("mh-new_module:show_settings"),i=new MH_PageComposer.BlockModuleView(s),void 0!==t.attributes.view&&"on"===t.attributes.view.model.get("mhc_fullwidth")?(z.getView(t.get("parent")).addChildView(i),r=z.getView(t.get("parent")).model.get("mhc_template_type")):void 0!==t.attributes.view&&(r=z.getView(z.getView(t.get("parent")).model.get("parent")).model.get("mhc_template_type")),a)z.getView(t.get("parent")).$el.find('div[data-cid="'+a+'"]').after(i.render().el);else if(z.getView(t.get("parent")).$el.find(".mhc-insert-module").length)z.getView(t.get("parent")).$el.find(".mhc-insert-module").before(i.render().el);else{var h=z.getView(t.get("parent"));void 0!==h.model.get("mhc_fullwidth")&&"on"===h.model.get("mhc_fullwidth")?h.$el.find(".mhc_fullwidth_sortable_area").append(i.render().el):h.$el.append(i.render().el)}z.addView(t.get("cid"),i),void 0!==r&&"module"===r&&t.set("template_type","module",{silent:!0}),"manually"!==t.get("created")&&(s.attributes={"data-open_view":"module_settings"},this.openModuleSettings(s))}}t.unset("cloned_cid")},openModuleSettings:function(t){var i=new MH_PageComposer.ModalView(t),o=this;if(mh_modal_view_rendered=i.render(),!1===mh_modal_view_rendered)return setTimeout(function(){o.openModuleSettings(t)},500),void E.trigger("mhc-loading:started");E.trigger("mhc-loading:ended"),e("body").append(mh_modal_view_rendered.el)},saveAsShortcode:function(e,t,i){arguments.length>0&&"object"==typeof arguments[0]&&arguments[0].mh_action;i&&"false"==i.update_shortcodes||(shortcode=this.generateCompleteShortcode(),this.addHistory(shortcode),setTimeout(function(){v("content",shortcode),E.trigger("mhc-content-updated")},500))},generateCompleteShortcode:function(t,i,o,n){var s="",a=this,l=void 0===t,i=void 0===i?"":i;return this.$el.find(".mhc_section").each(function(){var d=e(this).find(".mhc-section-content"),c=!1,r=void 0!==d.data("skip")&&d.data("skip");(!1===l&&t===d.data("cid")||!0===l)&&!0!==r&&(s+=a.generateModuleShortcode(e(this),!0,i,o),c=!0),d.closest(".mhc_section").hasClass("mhc_section_fullwidth")?d.find(".mhc_module_block").each(function(){var d=e(this).data("cid");(!1!==l||t!==d&&!0!==c)&&!0!==l||(s+=a.generateModuleShortcode(e(this),!1,i,o,"",n))}):!d.closest(".mhc_section").hasClass("mhc_section_specialty")||!0!==c&&!0!==l&&"module"!==i&&"row"!==i||!0===r?d.find(".mhc_row").each(function(){var d=e(this),r=d.find(".mhc-row-content"),h=r.data("cid"),m=!1,_=void 0!==r.data("skip")&&r.data("skip");(!1!==l||t!==h&&!0!==c)&&!0!==l||!0===_||(s+=a.generateModuleShortcode(e(this),!0,i,o),m=!0),d.find(".mhc-column").each(function(){var d=e(this),r=d.data("cid"),h=j.findWhere({cid:r});(!1!==l||!0!==c&&!0!==m)&&!0!==l||!0===_||(s+='[mhc_column type="'+h.get("layout")+'"]'),d.find(".mhc_module_block").each(function(){var d=e(this).data("cid");(!1!==l||t!==d&&!0!==c&&!0!==m)&&!0!==l||(s+=a.generateModuleShortcode(e(this),!1,i,o,"",n))}),(!1!==l||!0!==c&&!0!==m)&&!0!==l||!0===_||(s+="[/mhc_column]")}),(!1!==l||t!==h&&!0!==c)&&!0!==l||!0===_||(s+="[/mhc_row]")}):d.find("> .mhc-column").each(function(){var d=e(this),r=d.data("cid"),h=j.findWhere({cid:r}),m="1"===h.get("layout_specialty")?' specialty_columns="'+h.get("specialty_columns")+'"':"",_=h.get("layout");!0!==c&&!0!==l||(s+='[mhc_column type="'+_+'"'+m+"]"),d.hasClass("mhc-column-specialty")?d.find(".mhc_row").each(function(){var d=e(this),r=d.find(".mhc-row-content").data("cid"),h=(j.findWhere({cid:r}),!1);(!0===c||!0===l||"row"===i&&r===t)&&(h=!0,s+=a.generateModuleShortcode(e(this),!0,i,o,"row_inner")),d.find(".mhc-column").each(function(){var d=e(this),r=d.data("cid"),m=j.findWhere({cid:r});!0===h&&(s+='[mhc_column_inner type="'+m.get("layout")+'" saved_specialty_column_type="'+_+'"]'),d.find(".mhc_module_block").each(function(){var d=e(this).data("cid");(!1!==l||t!==d&&!0!==c&&!0!==h)&&!0!==l||(s+=a.generateModuleShortcode(e(this),!1,i,o,"",n))}),!0===h&&(s+="[/mhc_column_inner]")}),(!0===c||!0===l||"row"===i&&r===t)&&(s+="[/mhc_row_inner]")}):d.find(".mhc_module_block").each(function(){var d=e(this).data("cid");(!1!==l||t!==d&&!0!==c)&&!0!==l||(s+=a.generateModuleShortcode(e(this),!1,i,o,"",n))}),!0!==c&&!0!==l||(s+="[/mhc_column]")}),(!1===l&&t===d.data("cid")||!0===l)&&!0!==r&&(s+="[/mhc_section]")}),s},generateModuleShortcode:function(t,i,o,n,s,a){var l,d,c,r="",h="",m=t,p=m.is(".mhc_section")||m.is(".mhc_row")||m.is(".mhc_row_inner")?"mhc_":"",u=void 0===m.data("cid")?m.find(".mhc-data-cid").data("cid"):m.data("cid"),g=j.find(function(e){return e.get("cid")==u}),v=void 0!==g?g.get("module_type"):"undefined";void 0!==s&&""!==s&&(v=s),l=g.attributes;for(var f in l)if((void 0===n||"ignore_shared"!==n||void 0!==n&&"ignore_shared"===n&&"mhc_shared_module"!==f&&"mhc_shared_parent"!==f)&&(void 0===a||"ignore_shared_tabs"!==a||void 0!==a&&"ignore_shared_tabs"===a&&"mhc_saved_tabs"!==f)){var w,y=f;if(-1===y.indexOf("mhc_")&&"admin_label"!==y)continue;if(w=void 0!==g.get(y)?g.get(y):"","mhc_content_new"===y||"mhc_raw_content"===y)h=w,"mhc_raw_content"===y&&(h=_.escape(h)),h=e.trim(h),"mhc_content_new"===y&&(h="\n\n"+h+"\n\n");else if(""!==w){if(void 0!==l.module_defaults&&void 0!==l.module_defaults[y]){if(l.module_defaults[y]===w){delete g.attributes[y];continue}}y=y.replace("mhc_",""),"string"==typeof w&&(w=w.replace(/\"/g,"%22")),r+=" "+y+'="'+w+'"'}}return c="section"!==v&&"row"!==v?"module":v,c="row_inner"===v?"row":c,void 0!==o&&o===c&&(r+=' template_type="'+o+'"'),void 0!==l.template_type&&(r+=' template_type="'+l.template_type+'"'),d="["+p+v+r,""===h&&void 0!==l.type&&"module"===l.type?(i=!0,d+=" /]"):d+="]",i||(d+=h+"[/"+p+v+"]"),d},makeSectionsSortable:function(){var e=this;this.$el.sortable({items:"> *:not(#mhc_layout_controls, #mhc_main_container_right_click_overlay, #mhc-histories-visualizer, #mhc-histories-visualizer-overlay)",cancel:".mhc-settings, .mhc-clone, .mhc-remove, .mhc-section-add, .mhc-row-add, .mhc-insert-module, .mhc-insert-column, .mhc_locked, .mhc-disable-sort",delay:100,update:function(t,i){e.allowHistorySaving("moved","section"),E.trigger("mh-sortable:update")},start:function(e,t){i()}})},reInitialize:function(){var e=p("content"),t=""==e,i=mhc_options.default_initial_column_type,o=mhc_options.default_initial_text_module;E.trigger("mhc-loading:started"),this.removeAllSections(),-1===e.indexOf("[mhc_section")&&(t||(e='[mhc_column type="'+i+'"]['+o+"]"+e+"[/"+o+"][/mhc_column]"),e="[mhc_section][mhc_row]"+e+"[/mhc_row][/mhc_section]"),this.createNewLayout(e),E.trigger("mhc-loading:ended")},removeAllSections:function(t){var i;z.set("forceRemove",!0),this.$el.find(".mhc-section-content").each(function(){var t=e(this),i=z.getView(t.data("cid"));void 0!==i&&i.removeSection(!1,!0)}),z.set("forceRemove",!1),t&&(i="[mhc_section][mhc_row][/mhc_row][/mhc_section]",this.createNewLayout(i))},createNewLayout:function(e,t){t=t||"";this.stopListening(this.collection,"change reset add",this.saveAsShortcode),"load_layout"===t&&void 0!==window.switchEditors&&(e=(e=(e=(e=(e=window.switchEditors.wpautop(e)).replace(/<p>\[/g,"[")).replace(/\]<\/p>/g,"]")).replace(/\]<br \/>/g,"]")).replace(/<br \/>\n\[/g,"[")),this.createLayoutFromContent(e),this.saveAsShortcode({mh_action:t}),this.listenTo(this.collection,"change reset add",_.debounce(this.saveAsShortcode,128))},replaceElement:function(e,t){var i=z.getView(e);i.$el.after(t.render().el),i.model.destroy(),z.removeView(e),i.remove()},showRightClickOptions:function(e){e.preventDefault();var t={model:{attributes:{type:"app",module_type:"app"}},view:this.$el,view_event:e};new MH_PageComposer.RightClickOptionsView(t)},hideRightClickOptions:function(e){e.preventDefault(),i()},recalculateModulesOrder:function(){this.collection;this.order_modules_array=[],this.order_modules_array.children_count=[],this.$el.find(".mhc_section").each(function(){var t=e(this).find(".mhc-section-content"),i=t.data("cid");F.setModuleOrder(i),t.closest(".mhc_section").hasClass("mhc_section_fullwidth")?t.find(".mhc_module_block").each(function(){var t=e(this).data("cid");F.setModuleOrder(t)}):t.closest(".mhc_section").hasClass("mhc_section_specialty")?t.find("> .mhc-column").each(function(){var t=e(this),i=t.data("cid");F.setModuleOrder(i),t.hasClass("mhc-column-specialty")?t.find(".mhc_row").each(function(){var t=e(this),i=t.find(".mhc-row-content").data("cid");F.setModuleOrder(i),t.find(".mhc-column").each(function(){var t=e(this),i=t.data("cid");F.setModuleOrder(i),t.find(".mhc_module_block").each(function(){var t=e(this).data("cid");F.setModuleOrder(t)})})}):t.find(".mhc_module_block").each(function(){var t=e(this).data("cid");F.setModuleOrder(t,"specialty")})}):t.find(".mhc_row").each(function(){var t=e(this),i=t.find(".mhc-row-content").data("cid");F.setModuleOrder(i),t.find(".mhc-column").each(function(){var t=e(this),i=t.data("cid");F.setModuleOrder(i),t.find(".mhc_module_block").each(function(){var t=e(this).data("cid");F.setModuleOrder(t)})})})})},updateYoastContent:function(){if(L()){var t=p("content",!0);e.ajax({type:"POST",url:mhc_options.ajaxurl,data:{action:"mhc_execute_content_shortcodes",mh_admin_load_nonce:mhc_options.mh_admin_load_nonce,mhc_unprocessed_data:t},success:function(e){ae=e,YoastSEO.app.pluginReloaded("MHC_Yoast_Content")}})}},setModuleOrder:function(t,i){var o,n,s,a,l,d,c=e.parseJSON(mhc_options.mh_composer_modules_with_children);"column"!==(a=void 0!==(o=j.findWhere({cid:t})).attributes.module_type?o.attributes.module_type:o.attributes.type)&&"column_inner"!==a&&"specialty"!==i||(s=j.findWhere({cid:o.attributes.parent}),"column"===a&&"row_inner"===s.attributes.module_type&&(a="column_inner")),n=void 0!==this.order_modules_array[a]?this.order_modules_array[a]:0,o.attributes.module_order=n,"row"!==a&&"row_inner"!==a&&"section"!==a||void 0===o.attributes.columns_order||(o.attributes.columns_order=[]),"column"!==a&&"column_inner"!==a&&"specialty"!==i||(void 0!==s.attributes.columns_order?s.attributes.columns_order.push(n):s.attributes.columns_order=[n]),void 0!==c[a]&&(d=c[a],l=void 0!==this.order_modules_array.children_count[d]?this.order_modules_array.children_count[d]:0,o.attributes.child_start_from=l,void 0!==o.attributes.mhc_content_new&&""!==o.attributes.mhc_content_new&&(mhc_shortcodes_tags=F.getShortCodeChildTags(),reg_exp=window.wp.shortcode.regexp(mhc_shortcodes_tags),matches=o.attributes.mhc_content_new.match(reg_exp),l+=null!==matches?matches.length:0),this.order_modules_array.children_count[d]=l),this.order_modules_array[a]=n+1},updateAdvancedModulesOrder:function(t){var i,o=void 0!==t?t.find(".mhc-option-advanced-module-settings"):e(".mhc-option-advanced-module-settings"),n=0;o.length&&(i=o.find(".mhc-sortable-options > li")).length&&i.each(function(){var t,i,o,s=e(this).data("cid");t=j.findWhere({cid:s}),o=void 0!==(i=j.findWhere({cid:t.attributes.parent_cid})).attributes.child_start_from?i.attributes.child_start_from:0,t.attributes.module_order=n+o,n++})}}),e("body").on("click contextmenu","#mhc_layout_right_click_overlay",function(e){e.preventDefault(),i()});var U,E=_.extend({},Backbone.Events),z=new MH_PageComposer.Layout,j=new MH_PageComposer.Modules,B=new MH_PageComposer.Histories,F=new MH_PageComposer.AppView({model:MH_PageComposer.Module,collection:j,history:B}),W=new MH_PageComposer.visualizeHistoriesView,J=e("#mhc_hidden_editor"),q=J.html(),K=e("#mhc_toggle_composer"),Y=e(".mhc_toggle_composer_wrapper"),G=e("#mhc_layout"),Q=e("#mhc_old_content"),Z=e("#formatdiv"),X=e("#mhc_use_composer"),ee=e("#mhc_main_editor_wrap"),te=e(".mhc_page_setting"),ie=e(".mhc_page_layout_settings"),oe=[],ne=0,se=0,ae=!1,le={};if(MH_PageComposer.Events=E,J.remove(),Y.hasClass("mhc_composer_is_used")&&(G.show(),m()),K.click(function(t){t.preventDefault();var i,o=e(this);o.hasClass("mhc_composer_is_used")?d("deactivate_composer"):(i=p("content"),Q.val(i),F.reInitialize(),X.val("on"),G.show(),o.text(o.data("editor")),ee.toggleClass("mhc_hidden"),o.toggleClass("mhc_composer_is_used"),E.trigger("mh-activate-composer"),m())}),MHC_Clipboard={key:"mhc_clipboard_",set:function(e,t){N()?(localStorage.setItem(this.key+"type",e),localStorage.setItem(this.key+"content",t)):alert(mhc_options.localstorage_unavailability_alert)},get:function(e){if(N()){var t=localStorage.getItem(this.key+"type"),i=localStorage.getItem(this.key+"content");return(void 0===e||e===t)&&i}alert(mhc_options.localstorage_unavailability_alert)}},e(window).keydown(function(t){if(void 0===t.target||!e(t.target).is("input, textarea"))return 90===t.keyCode&&t.metaKey&&t.shiftKey&&!t.altKey||90===t.keyCode&&t.ctrlKey&&t.shiftKey&&!t.altKey?(t.preventDefault(),F.redo(t),!1):90===t.keyCode&&t.metaKey&&!t.altKey||90===t.keyCode&&t.ctrlKey&&!t.altKey?(t.preventDefault(),F.undo(t),!1):void 0}),L()){var de=function(){YoastSEO.app.registerPlugin("MHC_Yoast_Content",{status:"ready"}),YoastSEO.app.registerModification("content",this.mhc_update_content,"MHC_Yoast_Content",5)};de.prototype.mhc_update_content=function(e){return ae||mhc_options.yoast_content},new de}e(window).resize(function(){var t=e(".mhc_prompt_modal.mhc_auto_centerize_modal");t.length&&(t.removeAttr("style"),window.mhc_align_vertical_modal(t,".mhc_prompt_buttons"))})})}(jQuery),function(e){window.mh_composer=window.mh_composer||{},void 0!==window.YoastShortcodePlugin&&(window.YoastShortcodePlugin.prototype.bindElementEvents=function(){var e=document.getElementById("content")||!1,t=this;e&&(e.addEventListener("keydown",this.loadShortcodes.bind(this,this.declareReloaded.bind(this))),e.addEventListener("change",this.loadShortcodes.bind(this,this.declareReloaded.bind(this)))),"undefined"!=typeof tinyMCE&&"function"==typeof tinyMCE.on&&tinyMCE.on("addEditor",function(e){e.editor.on("change",function(){t.loadShortcodes.bind(t,t.declareReloaded.bind(t))()})})}),e(document).ready(function(){function t(){var t=e(".mhc_modal_settings_container");t.find("div.mce-fullscreen").length&&setTimeout(function(){var e=t.innerHeight(),i=t.find(".mce-toolbar-grp").innerHeight();t.find("iframe").height(e-i)},100)}var i={};window.mh_composer_template_options={tabs:{},switch_button:{}},MH_PageComposer.Events.on("mh-advanced-module-settings:render",function(t){$select_field=t.$el.find("#mhc_category_id"),$hidden_name_field=t.$el.find("#mhc_category_name"),$select_field.length&&$hidden_name_field.length&&(category_name=$select_field.find("option:selected").text().trim(),$hidden_name_field.val(category_name),$select_field.on("change",function(){category_name=e(this).find("option:selected").text().trim(),$hidden_name_field.val(category_name)}))}),i={font_icon_list_template:function(){return e("#mh-composer-font-icon-list-items").html()},steadysets_icon_list_template:function(){return e("#mh-composer-font-steadysets-icon-list-items").html()},awesome_icon_list_template:function(){return e("#mh-composer-font-awesome-icon-list-items").html()},etline_icon_list_template:function(){return e("#mh-composer-font-etline-icon-list-items").html()},lineicons_icon_list_template:function(){return e("#mh-composer-font-lineicons-icon-list-items").html()},icomoon_icon_list_template:function(){return e("#mh-composer-font-icomoon-icon-list-items").html()},linearicons_icon_list_template:function(){return e("#mh-composer-font-linearicons-icon-list-items").html()},preview_tabs_output:function(){return e("#mh-composer-preview-icons-template").html()},options_tabs_output:function(t){var i=_.template(e("#mh-composer-options-tabs-links-template").html());return window.mh_composer_template_options.tabs.options=e.extend({},t),i(window.mh_composer_template_options.tabs)},options_switch_button_output:function(t){var i=_.template(e("#mh-composer-switch-button-template").html());return window.mh_composer_template_options.switch_button.options=e.extend({},t),i(window.mh_composer_template_options.switch_button)}},e.extend(window.mh_composer,i),e("body").on("click",".mhc_module_settings .mce-i-fullscreen",function(){t()}),e(window).resize(function(){t()}),e(document).keydown(function(t){if(e(".mhc_modal_settings_container").is(":focus")||e(".mhc_modal_settings_container *").is(":focus")||e(".mhc_prompt_modal").is(":visible")){var i=e(".mhc-modal-save"),o=e(".mhc_prompt_proceed"),n=e(".mhc-modal-close"),s=e("#mhc_main_container a, #mhc_toggle_composer");switch(t.which){case 13:if(e(".mhc-option-container textarea, #mhc_address, #mhc_pin_address").is(":focus"))return;s.blur(),(i.length||o.length)&&(o.length?o.click():void 0!==i[1]?i[1].click():i.click());break;case 27:n.length&&(void 0!==n[1]?n[1].click():n.click())}}})}),e(".mhc_hide_cache_notice").click(function(){e(this).closest(".update-nag").hide(),e.ajax({type:"POST",url:mhc_options.ajaxurl,data:{action:"mhc_hide_cache_notice",mh_admin_load_nonce:mhc_options.mh_admin_load_nonce}})}),e("body.wp-admin").on("click",'.mhc-modal-container .mce-widget.mce-btn[aria-label="Fullscreen"] button',function(){setTimeout(function(){e(window).trigger("resize")},50)})}(jQuery);